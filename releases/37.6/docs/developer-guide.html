<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="The INCEpTION Team">
<title>INCEpTION Developer Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Generate a nice TOC -->
<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.1.0.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>

<!-- We do not need the tocify CSS because the asciidoc CSS already provides most of what we need -->

<style>
  .tocify-header {
    font-style: italic;
  }

  .tocify-subheader {
    font-style: normal;
    font-size: 90%;
  }

  .tocify ul {
    margin: 0;
  }

  .tocify-focus {
    color: #7a2518;
    background-color: rgba(0, 0, 0, 0.1);
  }

  .tocify-focus > a {
    color: #7a2518;
  }
</style>

<script>
    $(function () {
        // Add a new container for the tocify toc into the existing toc so we can re-use its
        // styling
        $("#toc").append("<div id='generated-toc'></div>");
        $("#generated-toc").tocify({
            extendPage: true,
            context: "#content",
            highlightOnScroll: true,
            hideEffect: "slideUp",
            // Use the IDs that asciidoc already provides so that TOC links and intra-document
            // links are the same. Anything else might confuse users when they create bookmarks.
            hashGenerator: function(text, element) {
                return $(element).attr("id");
            },
            // Smooth scrolling doesn't work properly if we use the asciidoc IDs
            smoothScroll: false,
            // Set to 'none' to use the tocify classes
            theme: "none",
            // Handle book (may contain h1) and article (only h2 deeper)
            selectors: $( "#content" ).has( "h1" ).length > 0 ? "h1,h2,h3,h4,h5" : "h2,h3,h4,h5",
            ignoreSelector: ".discrete"
        });

        // Switch between static asciidoc toc and dynamic tocify toc based on browser size
        // This is set to match the media selectors in the asciidoc CSS
        // Without this, we keep the dynamic toc even if it is moved from the side to preamble
        // position which will cause odd scrolling behavior
        var handleTocOnResize = function() {
            if ($(document).width() < 768) {
                $("#generated-toc").hide();
                $(".sectlevel0").show();
                $(".sectlevel1").show();
            }
            else {
                $("#generated-toc").show();
                $(".sectlevel0").hide();
                $(".sectlevel1").hide();
            }
        }

        $(window).resize(handleTocOnResize);
        handleTocOnResize();
    });
</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>INCEpTION Developer Guide</h1>
<div class="details">
<span id="author" class="author">The INCEpTION Team</span><br>
<span id="revnumber">version 37.6</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_core_technology">Core technology</a></li>
<li><a href="#_system_requirements">System Requirements</a></li>
</ul>
</li>
<li><a href="#sect_setup">Setup</a>
<ul class="sectlevel1">
<li><a href="#_source_code_management">Source code management</a>
<ul class="sectlevel2">
<li><a href="#_development_workflow">Development workflow</a></li>
<li><a href="#_git_configuration">Git configuration</a></li>
</ul>
</li>
<li><a href="#_code_style">Code style</a></li>
<li><a href="#_setting_up_for_the_development_in_eclipse">Setting up for the development in Eclipse</a>
<ul class="sectlevel2">
<li><a href="#_use_a_jdk">Use a JDK</a></li>
<li><a href="#_eclipse_plug_ins">Eclipse Plug-ins</a></li>
<li><a href="#_eclipse_workspace_settings">Eclipse Workspace Settings</a></li>
<li><a href="#_importing_inception_into_the_workspace">Importing INCEpTION into the Workspace</a></li>
<li><a href="#_setting_up_checkstyle_and_formatting">Setting up Checkstyle and Formatting</a></li>
</ul>
</li>
<li><a href="#_setting_up_for_the_development_in_intellij_idea">Setting up for the development in IntelliJ IDEA</a>
<ul class="sectlevel2">
<li><a href="#_checkstyle_and_formatting">Checkstyle and Formatting</a></li>
<li><a href="#_intellij_idea_tomcat_integration">IntelliJ IDEA Tomcat Integration</a></li>
<li><a href="#_building_documentation">Building documentation</a></li>
</ul>
</li>
<li><a href="#_running_inception">Running INCEpTION</a></li>
</ul>
</li>
<li><a href="#_architecture">Architecture</a>
<ul class="sectlevel1">
<li><a href="#_wicket_pages">Wicket pages</a></li>
<li><a href="#_services">Services</a></li>
<li><a href="#_database">Database</a>
<ul class="sectlevel2">
<li><a href="#_migration">Migration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_modules">Modules</a>
<ul class="sectlevel1">
<li><a href="#_documents">Documents</a>
<ul class="sectlevel2">
<li><a href="#_source_documents">Source documents</a></li>
<li><a href="#_annotation_documents">Annotation documents</a></li>
</ul>
</li>
<li><a href="#_annotation_schema">Annotation Schema</a>
<ul class="sectlevel2">
<li><a href="#_layers">Layers</a>
<ul class="sectlevel3">
<li><a href="#_span_layer">Span layer</a></li>
<li><a href="#_relation_layer">Relation layer</a></li>
<li><a href="#_document_metadata">Document Metadata</a></li>
<li><a href="#_layers_behaviors">Layers Behaviors</a></li>
</ul>
</li>
<li><a href="#_features">Features</a></li>
</ul>
</li>
<li><a href="#sect_search">Search</a>
<ul class="sectlevel2">
<li><a href="#sect_search_mtas">Mtas Index</a></li>
</ul>
</li>
<li><a href="#sect_recommendation">Recommenders system</a>
<ul class="sectlevel2">
<li><a href="#_recommenders">Recommenders</a></li>
<li><a href="#_suggestion_supports">Suggestion supports</a></li>
<li><a href="#sect_recommender_tutorial">Implementing a custom recommender</a>
<ul class="sectlevel3">
<li><a href="#_setting_up_the_environment">Setting up the environment</a></li>
<li><a href="#_implementing_the_recommendationengine">Implementing the RecommendationEngine</a>
<ul class="sectlevel4">
<li><a href="#_recommendercontext">RecommenderContext</a></li>
<li><a href="#_training">Training</a></li>
<li><a href="#_predicting">Predicting</a></li>
<li><a href="#_evaluating">Evaluating</a></li>
</ul>
</li>
<li><a href="#_recommendationfactory">RecommendationFactory</a></li>
</ul>
</li>
<li><a href="#_external_recommender">External recommender</a>
<ul class="sectlevel3">
<li><a href="#_external_recommender_api_overview">Overview</a></li>
<li><a href="#_external_recommender_api_paths">API Endpoints</a>
<ul class="sectlevel4">
<li><a href="#_external_recommender_api_predictcas">Predict annotations for a single document</a>
<ul class="sectlevel5">
<li><a href="#_description">Description</a></li>
<li><a href="#_parameters">Parameters</a></li>
<li><a href="#_responses">Responses</a></li>
<li><a href="#_consumes">Consumes</a></li>
<li><a href="#_produces">Produces</a></li>
<li><a href="#_tags">Tags</a></li>
<li><a href="#_example_http_request">Example HTTP request</a>
<ul class="sectlevel6">
<li><a href="#_request_path">Request path</a></li>
<li><a href="#_request_body">Request body</a></li>
</ul>
</li>
<li><a href="#_example_http_response">Example HTTP response</a>
<ul class="sectlevel6">
<li><a href="#_response_200">Response 200</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_external_recommender_api_trainrecommender">Train recommender on a set of documents</a>
<ul class="sectlevel5">
<li><a href="#_description_2">Description</a></li>
<li><a href="#_parameters_2">Parameters</a></li>
<li><a href="#_responses_2">Responses</a></li>
<li><a href="#_consumes_2">Consumes</a></li>
<li><a href="#_tags_2">Tags</a></li>
<li><a href="#_example_http_request_2">Example HTTP request</a>
<ul class="sectlevel6">
<li><a href="#_request_path_2">Request path</a></li>
<li><a href="#_request_body_2">Request body</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_external_recommender_api_definitions">Definitions</a>
<ul class="sectlevel4">
<li><a href="#_external_recommender_api_document">Document</a></li>
<li><a href="#_external_recommender_api_metadata">Metadata</a></li>
<li><a href="#_external_recommender_api_predictrequest">PredictRequest</a></li>
<li><a href="#_external_recommender_api_predictresponse">PredictResponse</a></li>
<li><a href="#_external_recommender_api_train">Train</a></li>
</ul>
</li>
<li><a href="#_encoding_annotation_suggestions">Encoding annotation suggestions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sect_activeLearning">Active Learning</a>
<ul class="sectlevel2">
<li><a href="#_sampling_strategies">Sampling strategies</a>
<ul class="sectlevel3">
<li><a href="#sect_activeLearning_uncertaintySampling">Uncertainty sampling</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sect_log">Event Log</a>
<ul class="sectlevel2">
<li><a href="#sect_log_adapter">Event Logging Adapters</a></li>
</ul>
</li>
<li><a href="#sect_knowledgebase">Knowledge base</a>
<ul class="sectlevel2">
<li><a href="#sect_knowledgebase_irischema">Schema mapping</a></li>
</ul>
</li>
<li><a href="#sect_conceptlinking">Concept Linking</a>
<ul class="sectlevel2">
<li><a href="#_ranking">Ranking</a>
<ul class="sectlevel3">
<li><a href="#_feature_generators">Feature generators</a></li>
<li><a href="#_ranking_strategy">Ranking strategy</a></li>
</ul>
</li>
<li><a href="#_named_entity_linking_recommender">Named entity linking recommender</a></li>
</ul>
</li>
<li><a href="#sect_external_editors">External Editors</a>
<ul class="sectlevel2">
<li><a href="#_document_rendering_editors">Document-rendering editors</a></li>
<li><a href="#_editors_using_server_side_document_views">Editors using server-side document views</a></li>
<li><a href="#_views">Views</a></li>
<li><a href="#_policies">Policies</a>
<ul class="sectlevel3">
<li><a href="#_element_policies">Element policies</a></li>
<li><a href="#_attribute_policies">Attribute policies</a></li>
<li><a href="#_debugging">Debugging</a></li>
</ul>
</li>
<li><a href="#_editor_implementation">Editor implementation</a></li>
</ul>
</li>
<li><a href="#sect_pdf_editor_dev">PDF Annotation Editor</a></li>
<li><a href="#sect_pdf_editor_legacy_dev">PDF Annotation Editor (legacy)</a>
<ul class="sectlevel2">
<li><a href="#_selecting_a_pdf_annotation_tool">Selecting a PDF Annotation Tool</a></li>
<li><a href="#_differences_in_pdf_document_text_extractions">Differences in PDF Document Text Extractions</a></li>
<li><a href="#_preparing_representations">Preparing Representations</a></li>
<li><a href="#_mapping_annotations">Mapping Annotations</a></li>
</ul>
</li>
<li><a href="#_file_formats">File Formats</a></li>
<li><a href="#_repository">Repository</a></li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a>
<ul class="sectlevel1">
<li><a href="#sect_systemproperties">Appendix A: System Properties</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document targets developers working on INCEpTION.</p>
</div>
</div>
</div>
<h1 id="_introduction" class="sect0"><a class="anchor" href="#_introduction"></a>Introduction</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This document describes how INCEpTION internally works and how it can be extended
to fit your use case or project. It is targeted to software developers. At first,
we will give a brief overview of the used technology in INCEpTION, then describe
how to setup the working environment including version control, IDE and software
requirements. Then, the architecture itself with core services and extension points
is presented.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_technology"><a class="anchor" href="#_core_technology"></a>Core technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>INCEpTION is written as a Java application and heavily relies on Spring Boot. Its
user interface is a web application that is powered by <a href="https://wicket.apache.org">Apache Wicket</a>.
The Natural Language Processing components are mostly based on
<a href="https://dkpro.github.io/dkpro-core/">DKPro Core</a>. This includes the
tokenization, import and export to many different standard formats, as well as
recommenders i.e. machine learning tools that provide annotation support. The internal
data format heavily relies on <a href="https://uima.apache.org/">UIMA</a> and its
<a href="https://uima.apache.org/d/uimaj-current/references.html#ugr.ref.cas">CAS</a> format.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a>System Requirements</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Requirements for users</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chrome or Safari (latest versions)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph small">
<p>You should also be able to use INCEpTION with other browsers such as Firefox, Brave, etc. However, those are less regularly tested by the developers. It is recommended to always use the latest version of any browser product you may be using to ensure best compatibility.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Requirements to run the standalone version</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux (64bit), macOS (64bit), Windows (64bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Runtime Environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 17 or higher</p></td>
</tr>
</tbody>
</table>
<div class="paragraph small">
<p>The examples in this guide are based on a recent Debian Linux. Most of them should apply quite directly to Debian-based distributions like e.g. Ubuntu. INCEpTION will run on other distributions as well, but you may have to use different commands for managing users, installing software, etc.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Requirements run the server version</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux (64bit), macOS (64bit), Windows (64bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java Runtime Environment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 17 or higher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB version 10.6 or higher<br>
  MySQL version 8.0 or higher<br>
  MS SQL Server 2022 or higher (🧪 experimental)<br>
  PostgreSQL 16.3 or higher (🧪 experimental)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph small">
<p>You may be able to run INCEpTION on older database server versions but it may require extra configuration that is not included in this documentation. You may consider referring to older versions of this administrators guide included with older versions of INCEpTION.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Requirements for a Docker-based deployment</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Docker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version 24 or higher (arm64 or amd64)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="sect_setup" class="sect0"><a class="anchor" href="#sect_setup"></a>Setup</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This section covers setting up a development environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_source_code_management"><a class="anchor" href="#_source_code_management"></a>Source code management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use git as our source code management system and collaborate via the INCEpTION
repository on <a href="https://github.com/inception-project/inception">GitHub</a>.</p>
</div>
<div class="sect2">
<h3 id="_development_workflow"><a class="anchor" href="#_development_workflow"></a>Development workflow</h3>
<div class="paragraph">
<p>Every feature or bug fix needs to be tracked in an issue on GitHub. Development is done in branches.
Based on the milestone (see the issue description on GitHub), the new branch is either created from
master (if the code should be in the next major release) or from a bugfix release branch
(if the code should be in the next minor release). In order to get the code in production,
you need to create a pull request on GitHub of your branch into the target branch (as described before).</p>
</div>
<div class="paragraph">
<p>In order to contribute to INCEpTION, you need to create a pull request. This section briefly
guides you through the best way of doing this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Every feature or bug fix needs to be tracked in an issue on GitHub. If there is no issue for the
feature yet, create an issue first.</p>
</li>
<li>
<p>Create a branch based on the branch to which you wish to contribute. Normally, you should create
this branch from the master branch of the respective project. In the case that you want to fix a bug in
the latest released version, you should consider to branch off the latest maintenance branch (e.g.
0.10.x). If you are not sure, ask via the issue you have just created. Do <strong>not</strong> make changes directly
to the master or maintenance branches. The name of the branch should be e.g.
<code>feature/[ISSUE-NUMBER]-[SHORT-ISSUE-DESCRIPTION]</code> or <code>bugfix/[ISSUE-NUMBER]-[SHORT-ISSUE-DESCRIPTION]</code>.</p>
</li>
<li>
<p>Now you make changes to your branch. When committing to your branch, use the format shown below
for your commit messages. Note that <strong>#</strong> normally introduces comments in git. You may have to reconfigure
git before attempting an interactive rebase and switch it to another comment character.</p>
<div class="literalblock">
<div class="content">
<pre>#[ISSUE NUMBER] - [ISSUE TITLE]
[EMPTY LINE]
- [CHANGE 1]
- [CHANGE 2]
- [...]</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create the pull request any time after your first commit. I.e. you do not have to wait until
you are completely finished with your implementation. Creating a pull request early tells other
developers that you are actively working on an issue and facilitates asking questions about and
discussing implementation details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_git_configuration"><a class="anchor" href="#_git_configuration"></a>Git configuration</h3>
<div class="paragraph">
<p>Before committing, make sure that you specified your email and name in the git config so
that commits can be attributed to you. This can e.g. be done as described in the
<a href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup">Git Documentation</a>.</p>
</div>
<div class="paragraph">
<p>All sources files are stored using UNIX line endings. If you develop on Windows, you have to
set the <code>core.autocrlf</code> configuration setting to <code>input</code> to avoid accidentally submitting Windows
line endings to the repository. Using <code>input</code> is a good strategy in most cases, thus you should
consider setting this as a global (add <code>--global</code>) or even as a system (<code>--system</code>) setting.</p>
</div>
<div class="listingblock">
<div class="title">Configure git line ending treatment</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">C:\&gt; git config --global core.autocrlf input</code></pre>
</div>
</div>
<div class="paragraph">
<p>After changing this setting, best do a fresh clone and check-out of the project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_style"><a class="anchor" href="#_code_style"></a>Code style</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use a style for formatting the source code in INCEpTION. Our approach consists of two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DKPro code formatting profile - the profile configures your IDE to auto-format the code according to
our guidelines as you go.</p>
</li>
<li>
<p>Checkstyle - this tool is used to check if the source code is actually formatted according to our
guidelines. It is run as part of a Maven build and the build fails if the code is not formatted
properly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a brief summary of the formatting rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>no tabs, only spaces</p>
</li>
<li>
<p>indenting using 4 spaces in Java files and 2 spaces in XML files</p>
</li>
<li>
<p>maximum 100 characters per line (with a few exceptions)</p>
</li>
<li>
<p>curly braces on the next line for class/method declarations, same line for logic blocks (if/for/&#8230;&#8203;)</p>
</li>
<li>
<p>parameter names start with <code>a</code> (e.g. <code>void foo(String aValue)</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_for_the_development_in_eclipse"><a class="anchor" href="#_setting_up_for_the_development_in_eclipse"></a>Setting up for the development in Eclipse</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a guide to setting up a development environment using Eclipse on Mac OS X. The
procedure should be similar for other operation systems.</p>
</div>
<div class="paragraph">
<p>First, you need to follow some steps of the <a href="admin-guide.html#sect_installation">Administrator Installation Guide</a>.
It is recommended to configure a MySQL-server.</p>
</div>
<div class="paragraph">
<p>We recommend you start from a <strong>Eclipse IDE for Java Developers</strong> package.</p>
</div>
<div class="sect2">
<h3 id="_use_a_jdk"><a class="anchor" href="#_use_a_jdk"></a>Use a JDK</h3>
<div class="paragraph">
<p>On Linux or OS X, having a full JDK installed on your system is generally sufficient. You can skip
on to the next section.</p>
</div>
<div class="paragraph">
<p>On Windows, you need to edit the <code>eclipse.ini</code> file and directly before the <code>-vmargs</code> line, you
have to add the following two lines. Mind to replace <code>C:/Program Files/Java/jdk11</code> with the actual
location of the JDK/version on your system. Without this, Eclipse will complain that the
<code>jdk.tools:jdk.tools</code> artifact would be missing.</p>
</div>
<div class="listingblock">
<div class="title">Force Eclipse to run on a JDK</div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">-vm
C:/Program Files/Java/jdk11/jre/bin/server/jvm.dll</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_plug_ins"><a class="anchor" href="#_eclipse_plug_ins"></a>Eclipse Plug-ins</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Maven Integration:</strong> m2e , already comes pre-installed with the Eclipse IDE for Java Developers.
If you use another edition of Eclipse which does not have m2e pre-installed, go to <strong>Help&#8594;Install
New Software</strong>, select "--All available sites--" and choose <strong>Collaboration &#8594; m2e - Maven Integration
for Eclipse</strong></p>
</li>
<li>
<p><strong>Apache UIMA tools:</strong> go to <strong>Help&#8594;Install New Software</strong>, select "Add&#8230;&#8203;" and add the update site: <code><a href="http://www.apache.org/dist/uima/eclipse-update-site/" class="bare">http://www.apache.org/dist/uima/eclipse-update-site/</a></code> as a location. Install the <strong>Apache UIMA Eclipse tooling and runtime support</strong>.</p>
</li>
<li>
<p><strong>Eclipse Web Development Tooling:</strong> go to <strong>Help&#8594;Install New Software</strong>, select "--All available
sites--" and select the following plug-ins for installation from the section <strong>Web, XML, Java EE
and OSGi Enterprise Development</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Eclipse Java Web Developer Tools</p>
</li>
<li>
<p>Eclipse Web Developer Tools</p>
</li>
<li>
<p>Eclipse XML Editors and Tools: already comes pre-installed in newer Eclipse versions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_workspace_settings"><a class="anchor" href="#_eclipse_workspace_settings"></a>Eclipse Workspace Settings</h3>
<div class="ulist">
<ul>
<li>
<p>You should check that Text file encoding is <code>UTF-8</code> in <strong>Preferences &#8594; General &#8594; Workspace</strong>.</p>
</li>
<li>
<p>You need to enable Java annotation preprocessors. Go to <strong>Preferences &#8594; Maven &#8594; Annotation Processing</strong>
and set the <strong>Annotation Processing Mode</strong> to <strong>Automatic</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_importing_inception_into_the_workspace"><a class="anchor" href="#_importing_inception_into_the_workspace"></a>Importing INCEpTION into the Workspace</h3>
<div class="paragraph">
<p>Checkout out the INCEpTION git repository with your favorite git client. If you use the command-line
client, use the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ git clone https://github.com/inception-project/inception.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Eclipse, go to <strong>File &#8594; Import</strong>, choose <strong>Existing Maven projects</strong>, and select the folder to which
you have cloned INCEpTION. Eclipse should automatically detect all modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_checkstyle_and_formatting"><a class="anchor" href="#_setting_up_checkstyle_and_formatting"></a>Setting up Checkstyle and Formatting</h3>
<div class="paragraph">
<p>We use a style for formatting the source code in INCEpTION (see <a href="#_checkstyle_and_formatting">Checkstyle and Formatting</a>.
The following section describes how to use it with Eclipse.</p>
</div>
<div class="paragraph">
<p>First, obtain the DKPro code formatting profile from the <a href="https://dkpro.github.io/contributing/">DKPro website</a> (Section "Code style"). In Eclipse, go to <strong>Preferences &#8594; Java &#8594; Code Style &#8594; Formatter</strong> to import the file. Apparently, the files can also be used with IntelliJ via the [Eclipse Code Formatter](<a href="https://plugins.jetbrains.com/plugin/6546-eclipse-code-formatter" class="bare">https://plugins.jetbrains.com/plugin/6546-eclipse-code-formatter</a>) plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parameter prefix <code>a</code> needs to be configured manually. In Eclipse go to
       <strong>Preferences &#8594; Java &#8594; Code Style</strong> set the <strong>prefix list</strong> column in the <strong>parameters</strong> row to <code>a</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Second, install the Checkstyle plugin for Eclipse as well as the Maven Checkstyle plugin for Eclipse.
These plugins make Eclipse automatically pick up the checkstyle configuration from the Maven project
and highlight formatting problems directly in the source code editor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install <strong>Checkstyle Eclipse plugin</strong>: <code><a href="https://checkstyle.org/eclipse-cs/#!/install" class="bare">https://checkstyle.org/eclipse-cs/#!/install</a></code> e.g. via the update site: <code><a href="https://checkstyle.org/eclipse-cs/update" class="bare">https://checkstyle.org/eclipse-cs/update</a></code>.</p>
</li>
<li>
<p>Install the <strong>Checkstyle configuration plugin for M2Eclipse</strong>: via the update site <code><a href="http://m2e-code-quality.github.com/m2e-code-quality/site/latest/" class="bare">http://m2e-code-quality.github.com/m2e-code-quality/site/latest/</a></code></p>
</li>
<li>
<p>Select all INCEpTION projects, right click and do a <strong>Maven &#8594; Update project</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Should the steps mentioned above not have been sufficient, close all the INCEpTION projects
      in Eclipse, then remove them form the workspace (not from the disk), delete any <code>.checkstyle</code> files
      in the INCEpTION modules, and then re-import them into Eclipse again using <strong>Import&#8594;Existing Maven
      projects</strong>. During the project import, the Checkstyle configuration plugin for M2Eclipse should
      properly set up the <code>.checkstyle</code> files and activate checkstyle.<br>
      If the Maven project update cannot be completed due to missing .jars, execute a Maven install via right click on the inception project <strong>Run as &#8594;
      Maven build&#8230;&#8203;</strong>, enter the goal <code>install</code> and check <strong>Skip Tests</strong>. Alternatively, use the command <code>mvn clean install -DskipTests</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setting_up_for_the_development_in_intellij_idea"><a class="anchor" href="#_setting_up_for_the_development_in_intellij_idea"></a>Setting up for the development in IntelliJ IDEA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a guide to setting up a development environment using IntelliJ IDEA. We assume that the
Community Version is used, but this guide should also apply to the Enterprise Version.</p>
</div>
<div class="paragraph">
<p>After checking out INCEpTION from GitHub, open IntelliJ and import the project. The easiest
way is to go to <code>File &#8594; Open</code> and the select the <code>pom.xml</code> in the INCEpTION root directory.
IntelliJ IDEA will then guide you through the import process, the defaults work out of the box.
INCEpTION can now be started via running <code>inception-app-webapp/src/main/java/de/tudarmstadt/ukp/inception/INCEpTION.java</code>.</p>
</div>
<div class="paragraph">
<p>If you get errors that certain classes are not found, then open a terminal, go to the INCEpTION
repository root and run</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mvn clean install -DskipTests=true -Dcheckstyle.skip=true</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can run the <code>clean</code> and <code>install</code> Maven goals from IntelliJ manually.</p>
</div>
<div class="paragraph">
<p>If you get an error that the command line is too long, please go to <code>Run &#8594; Edit Configurations &#8594; Modify Options &#8594; Shorten Command Line</code> in IntelliJ IDEA and select the option <code>@argfile (Java 9+) - java @argfile className [args]</code>.</p>
</div>
<div class="sect2">
<h3 id="_checkstyle_and_formatting"><a class="anchor" href="#_checkstyle_and_formatting"></a>Checkstyle and Formatting</h3>
<div class="paragraph">
<p>We use a style for formatting the source code in INCEpTION (see <a href="#_checkstyle_and_formatting">Checkstyle and Formatting</a>.
The following section describes how to use it with IntelliJ IDEA.</p>
</div>
<div class="paragraph">
<p>First, install the <a href="https://plugins.jetbrains.com/plugin/1065-checkstyle-idea">Checkstyle-IDEA plugin</a>.
In <code>File | Settings | Other Settings | Checkstyle</code>, navigate to the <strong>Checkstyle</strong> tab. Start to add
a new configuration file by clicking on the <code>+</code> on the right, navigate to
<code>inception-build/src/main/resources/inception/checkstyle.xml</code> and apply the changes. Make sure to
check the box next to the newly created configuration and apply it as well.</p>
</div>
<div class="paragraph">
<p>In order to achieve the same formatting and import order as Eclipse, install the
<a href="https://plugins.jetbrains.com/plugin/6546-eclipse-code-formatter/versions">Eclipse Code Formatter</a>.
Download the <a href="https://dkpro.github.io/files/DKProStyle_latest.xml">DKPro Eclipse Code Style file</a>.
In <code>File | Settings | Other Settings | Eclipse Code Formatter</code>, create a new profile using this
file.</p>
</div>
<div class="paragraph">
<p>Also make sure to enable auto import optimization in <code>File | Settings | Editor | General | Auto Import</code>.</p>
</div>
<div class="paragraph">
<p>To format your source code on save, we also recommend to install the
<a href="https://plugins.jetbrains.com/plugin/7642-save-actions">Save Actions</a> plugin and configure it
accordingly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_intellij_idea_tomcat_integration"><a class="anchor" href="#_intellij_idea_tomcat_integration"></a>IntelliJ IDEA Tomcat Integration</h3>
<div class="paragraph">
<p>This requires IntelliJ IDEA Ultimate. Using Tomcat allows editing HTML,CSS and JavaScript on the fly without restarting
the application. First, download Apache Tomcat from <code><a href="http://tomcat.apache.org/" class="bare">http://tomcat.apache.org/</a></code> (we&#8217;re using version 8.5).
Then, you need to create a Tomcat server runtime configuration in <code>Run | Edit Configurations…</code>. Click on the <code>` icon,
select `Tomcat Server -&gt; Local`.  Click on the `Deployment` tab and then on the `</code> icon to select an artifact to deploy.
Choose the exploded war version. Select the <code>Server</code> tab, navigate to the path of your Tomcat server, and update the
<code>on Update</code> action to <code>Update classes and resources</code> for both. Make sure that all port settings are different.
You now can start or debug your web application via Tomcat. If starting throws a permission error, make sure that
the mentioned file, e.g. <code>catalina.sh</code> is marked as executable.</p>
</div>
<div class="paragraph">
<p><strong>Experimental:</strong> If desired, you can also use hot-code replacement via <a href="http://hotswapagent.org">HotswapAgent</a>.
This allows you to change code, e.g. adding methods without needing to restart the Tomcat server.
For this, follow the excellent <a href="https://github.com/dmitry-zhuravlev/hotswap-agent-intellij-plugin">HotSwap IntelliJ IDEA plugin guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_documentation"><a class="anchor" href="#_building_documentation"></a>Building documentation</h3>
<div class="paragraph">
<p>The documentation can be built using a support class in <code>inception-doc/src/test/java/de/tudarmstadt/ukp/inception/doc/GenerateDocumentation.java</code>.
To make it usable from Intellij IDEA, you need to build the whole project at least once. Run the
class. If it fails, alter the run configuration and add a new environment variable <code>INTELLIJ=true</code>
and check that the working directory is the INCEpTION root directory. The resulting documentation
will be in <code>target/doc-out</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_inception"><a class="anchor" href="#_running_inception"></a>Running INCEpTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run INCEpTION from your IDE, locate the class <code>de.tudarmstadt.ukp.inception.INCEpTION</code> and run it
as a Java application. This runs INCEpTION as a Spring Boot application using an embedded
web server - similar to running the compiled JAR file from the command line. You may want to define
the following system properties in your launch configuration:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inception.home</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/home/username/inception-dev</code> (adjust to your situation)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the application data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wicket.core.settings.general.configuration-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>development</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the development mode. This e.g. disables caches so that changes to HTML files in the IDE directly reflect in the running application.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="_architecture" class="sect0"><a class="anchor" href="#_architecture"></a>Architecture</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>INCEpTION uses a standard 3-layer architecture with the presentation layer using Wicket
at the top, the business layer heavily relying on Spring Boot and the data layer which is
interfaced with Hibernate at the bottom.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_pages"><a class="anchor" href="#_wicket_pages"></a>Wicket pages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wicket can only inject components that are interfaces. A pattern for these cases is to create an
<code>ExampleComponent</code> interface and implement it in an <code>ExampleComponentImpl</code> class.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_services"><a class="anchor" href="#_services"></a>Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Services encode the core logic of INCEpTION. They can be injected into Wicket pages and
other services to interact with the rest of the application. Services can inject Spring
components via autowiring. A good example of a service can e.g. be seen in the
<code>SchedulingService.java</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_database"><a class="anchor" href="#_database"></a>Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The database can be accessed via <a href="https://hibernate.org/">Hibernate</a>. The schema itself
and migrations are managed by <a href="https://www.liquibase.org/">Liquibase</a>.</p>
</div>
<div class="sect2">
<h3 id="_migration"><a class="anchor" href="#_migration"></a>Migration</h3>
<div class="paragraph">
<p>When changing the database schema, migrations from the current schema to the new one
need to be defined. They describe how the schema needs to be modified. This way,
INCEpTION can be upgraded to newer versions without needing to manually alter the
database schema. The migration process determines the current version of the schema
and only applies transformations from there to the newest one. Each module defines its
own data base tables and migrations in a file called <code>db-changelog.xml</code>. These are
automatically discovered by Liquibase and used when starting INCEpTION.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<h1 id="_modules" class="sect0"><a class="anchor" href="#_modules"></a>Modules</h1>
<div class="sect1">
<h2 id="_documents"><a class="anchor" href="#_documents"></a>Documents</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_source_documents"><a class="anchor" href="#_source_documents"></a>Source documents</h3>
<div class="paragraph">
<p>The original document uploaded by a user into a project. The document is preserved in its original
format.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotation_documents"><a class="anchor" href="#_annotation_documents"></a>Annotation documents</h3>
<div class="paragraph">
<p>Annotations made by a particular user on a document. The annotation document is persisted separately
from the original document. There is one annotation document per user per document. Within the tool,
a CAS data structure is used to represent the annotation document.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotation_schema"><a class="anchor" href="#_annotation_schema"></a>Annotation Schema</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_layers"><a class="anchor" href="#_layers"></a>Layers</h3>
<div class="paragraph">
<p>The layers mechanism allows supporting different types of annotation layers, e.g. span layers,
relation layers or chain layers. It consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>LayerSupport</code> interface provides the API for implementing layer types.</p>
</li>
<li>
<p>The <code>LayerSupportRegistry</code> interface and its default implementation <code>LayerSupportRegistryImpl</code>
serve as an access point to the different supported layer types.</p>
</li>
<li>
<p>The <code>LayerType</code> class which represents a short summary of a supported layer type. It is used
when selecting the type of a feature in the UI.</p>
</li>
<li>
<p>The <code>TypeAdapter</code> interface provides methods to create, manipulate or delete annotations on the
given type of layer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add support for a new type of layer, create a Spring component class which implements the
<code>LayerSupport</code> interface. Note that a single layer support class can handle multiple layer types.
However, it is generally recommended to implement a separate layer support for every layer type.
Implement the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getId()</code> to return a unique identifier for the new layer type. Typically the Spring bean name
is returned here.</p>
</li>
<li>
<p><code>getSupportedLayerTypes()</code> to return a list of all the supported layer types handled by the new
layer support. This values returned here are used to populate the layer type choice when creating
a new layer in the project settings.</p>
</li>
<li>
<p><code>accepts(AnnotationLayer)</code> to return <code>true</code> for any annotation layer that is handled by the new
layer support. I.e. <code>AnnotationLayer.getType()</code> must return a layer type identifier that was produced
by the given layer support.</p>
</li>
<li>
<p><code>generateTypes(TypeSystemDescription, AnnotationLayer)</code> to generate the UIMA type system for the given
annotation layer. This is a partial type system which is merged by the application with the
type systems produced by other layer supports as well as with the base type system of the
application itself (i.e. the DKPro Core type system and the internal types).</p>
</li>
<li>
<p><code>getRenderer(AnnotationLayer)</code> to return an early-stage renderer for the annotations on the
given layer.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The concept of layers is not yet fully modularized. Many parts of the application will only
      know how to deal with specific types of layers. Adding a new layer type should not crash the
      application, but it may also not necessarily be possible to actually use the new layer. In
      particular, changes to the TSV format may be required to support new layer types.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_span_layer"><a class="anchor" href="#_span_layer"></a>Span layer</h4>
<div class="paragraph">
<p>A span layer allows to create annotations over spans of text.</p>
</div>
<div class="paragraph">
<p>If <code>attachType</code> is set, then an annotation can only be created over the same span on which an
annotation of the specified type also exists. For span layers, setting <code>attachFeature</code> is mandatory
if a <code>attachType</code> is defined. The <code>attachFeature</code> indicates the feature on the annotation of the
<code>attachType</code> layer which is to be set to the newly created annotation.</p>
</div>
<div class="paragraph">
<p>For example, the <code>Lemma</code> layer has the <code>attachType</code> set to <code>Token</code> and the <code>attachFeature</code> set to
<code>lemma</code>. This means, that a new lemma annotation can only be created where a token already exists
and that the <code>lemma</code> feature of the token will point to the newly created lemma annotation.</p>
</div>
<div class="paragraph">
<p>Deleting an annotation that has other annotations attached to it will also cause the attached
annotations to be deleted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This case is currently not implemented because it is currently not allowed to
      create spans that attach to other spans. The only span type for which this is relevant
      is the <code>Token</code> type which cannot be deleted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_relation_layer"><a class="anchor" href="#_relation_layer"></a>Relation layer</h4>
<div class="paragraph">
<p>A relation layer allows to draw arcs between span annotations. The <code>attachType</code> is mandatory for
relation types and specifies which type of annotations arcs can be drawn between.</p>
</div>
<div class="paragraph">
<p>Arcs can only be drawn between annotations of the same layer. It is not possible to draw an arc
between two spans of different layers.</p>
</div>
<div class="paragraph">
<p>Only a single relation layer can attach to any given span layer.</p>
</div>
<div class="paragraph">
<p>If the <code>annotation_feature</code> is set, then the arc is not drawn between annotations of the layer
indicated by <code>annotation_type</code>, but between annotations of the type specified by the feature. E.g.
for a dependency relation layer, <code>annotation_type</code> would be set to <code>Token</code> and <code>annotation_feature</code>
to <code>pos</code>. The <code>Token</code> type has no visual representation in the UI. However, the <code>pos</code> feature points
to a <code>POS</code> annotation, which is rendered and between which the dependency relation arcs are then
drawn.</p>
</div>
<div class="paragraph">
<p>Deleting an annotation that is the endpoint of a relation will also delete the relation. In the case
that <code>annotation_feature</code>, this is also the case if the annotation pointed to is deleted. E.g. if
a POS annotation in the above example is deleted, then the attaching relation annotations are also
deleted.</p>
</div>
</div>
<div class="sect3">
<h4 id="_document_metadata"><a class="anchor" href="#_document_metadata"></a>Document Metadata</h4>
<div class="paragraph">
<p>A document metadata layer can be used to create annotations that apply to an entire document
instead of to a specific span of text.</p>
</div>
<div class="paragraph">
<p>Document metadata types inherit from the UIMA <code>AnnotationBase</code> type (text annotations inherit from
<code>Annotation</code>). As such, they do not have begin/end offsets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_layers_behaviors"><a class="anchor" href="#_layers_behaviors"></a>Layers Behaviors</h4>
<div class="paragraph">
<p>Layer behaviors allow to customize the way a layer of a particular span behaves, e.g. whether
a span is allowed to cross sentence boundaries, whether it anchors to characters or tokens,
whether the tree of relations among annotations is valid, etc.
The layer behaviors tie in with the specific <code>LayerSupport</code> implementations. The mechanism itself
consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>LayerBehavior</code> interface provides the API necessary for registering new behaviors. There are
abstract classes such as <code>SpanLayerBehavior</code> or <code>RelationLayerBehavior</code> which provide the APIs for
behaviors of specific layer types.</p>
</li>
<li>
<p>The <code>LayerBehaviorRegistry</code> and its default implementation <code>LayerBehaviorRegistryImpl</code>
serve as an access point to the different supported layer behaviors.
Any Spring component implementing the <code>LayerBehavior</code> interface is
loaded, and will be named in the logs when the web app is launched. The classpath scanning
used to locate Spring beans is limited to specific Java packages, e.g. any packages starting
with <code>de.tudarmstadt.ukp.clarin.webanno</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A layer behavior may have any of the following responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure that new annotations that are created conform with the behavior. This is done via the
<code>onCreate</code> method. If the annotation to be created does not conform with the behavior, the
method can cancel the creation of the annotation by throwing an <code>AnnotationException</code>.</p>
</li>
<li>
<p>Highlight annotations not conforming with the behavior. This is relevant when importing
pre-annotated files or when changing the behavior configuration of an existing layer. The
relevant method is <code>onRender</code>. If an annotation does not conform with the behavior, a error
marker should be added for problematic annotation. This is done by creating a <code>VComment</code>
which attaches an error message to a specified visual element, then adding that to the
response <code>VDocument</code>. Note that <code>onRender</code> is unlike <code>onCreate</code> and <code>onValidate</code> in that it
only has indirect access to the CAS: it is passed a mapping from <code>AnnotationFS</code> instances to
their corresponding visual elements, and can use <code>.getCAS()</code> on the FS. The annotation layer
can be identified from the visual element with <code>.getLayer().getName()</code>.</p>
</li>
<li>
<p>Ensure that documents being marked as <strong>finished</strong> conform with the behavior. This is done
via the <code>onValidate</code> method, which returns a list of <code>LogMessage, AnnotationFS</code> pairs
to report errors associated with each FS.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_features"><a class="anchor" href="#_features"></a>Features</h3>
<div class="paragraph">
<p>The features mechanism allows supporting different types of annotation features, e.g. string
features, numeric features, boolean features, link features, etc.
It consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>FeatureSupport</code> interface provides the API for implementing feature types.</p>
</li>
<li>
<p>The <code>FeatureSupportRegistry</code> interface and its default implementation <code>FeatureSupportRegistryImpl</code>
serve as an access point to the different supported feature types.</p>
</li>
<li>
<p>The <code>FeatureType</code> class which represents a short summary of a supported feature type. It is used
when selecting the type of a feature in the UI.</p>
</li>
<li>
<p>The <code>TypeAdapter</code> interface provides methods to create, manipulate or delete annotations on the
given type of layer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add support for a new type of feature, create a Spring component class which implements the
<code>FeatureSupport</code> interface. Note that a single feature support class can handle multiple feature types.
However, it is generally recommended to implement a separate layer support for every feature type.
Implement the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getId()</code> to return a unique identifier for the new feature type. Typically the Spring bean name
is returned here.</p>
</li>
<li>
<p><code>getSupportedFeatureTypes()</code> to return a list of all the supported feature types handled by the new
feature support. This values returned here are used to populate the feature type choice when
creating a new feature in the project settings.</p>
</li>
<li>
<p><code>accepts(AnnotationLayer)</code> to return <code>true</code> for any annotation layer that is handled by the new
layer support. I.e. <code>AnnotationLayer.getType()</code> must return a layer type identifier that was produced
by the given layer support.</p>
</li>
<li>
<p><code>generateFeature(TypeSystemDescription, TypeDescription, AnnotationFeature)</code> add the UIMA feature
definition for the given annotation feature to the given type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the new feature has special configuration settings, then implement the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readTraits(AnnotationFeature)</code> to extract the special settings form the given annotation feature
definition. It is expected that the traits are stored as a JSON string in the <code>traits</code> field
of <code>AnnotationFeature</code>. If the <code>traits</code> field is <code>null</code>, a new traits object must be returned.</p>
</li>
<li>
<p><code>writeTraits(AnnotationFeature, T)</code> to encode the layer-specific traits object into a JSON string
and store it in the <code>traits</code> field of <code>AnnotationFeature</code>.</p>
</li>
<li>
<p><code>createTraitsEditor(String, IModel&lt;AnnotationFeature&gt;</code> to create a custom UI for the special feature
settings. This UI is shown below the standard settings in the feature detail editor on the
<strong>Layers</strong> tab of the project settings.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_search"><a class="anchor" href="#sect_search"></a>Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The search  module contains the basic methods that implement the search service and search
functionalities of INCEpTION.</p>
</div>
<div class="paragraph">
<p>The <code>SearchService</code> and <code>SearchServiceImpl</code> classes define and implement the search service as a Spring component, allowing other modules of INCEpTION to create an index for a given project, and to perform queries over that index.</p>
</div>
<div class="paragraph">
<p>The indexes have two different aspects: the conceptual index, represented by the Index class, and the physical index, represented by a particular physical implementation of an index. This allows different search providers to be used by INCEpTION. Currently, the default search implementation uses Mtas (<a href="https://github.com/meertensinstituut/mtas" class="bare">https://github.com/meertensinstituut/mtas</a>), a Lucene / Solr based index engine that allows to annotate not only raw texts but also different linguistic annotations.</p>
</div>
<div class="paragraph">
<p>Every search provider is defined by its own index factory, with a general index registry to hold all the available search providers.</p>
</div>
<div class="sect2">
<h3 id="sect_search_mtas"><a class="anchor" href="#sect_search_mtas"></a>Mtas Index</h3>
<div class="paragraph">
<p>The Mtas index is implemented in the <strong>MtasDocumentIndex</strong> and <strong>MtasDocumentIndexFactory</strong> classes. Furthermore, the <strong>MtasUimaParser</strong> class provides a parser to be used by Lucene when adding a new document to the index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MtasDocumentIndexFactory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The factory allows to build a new MtasDocumentIndex through the getNewIndex method, which is called by the search service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MtasDocumentIndex</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This class holds the main functionalities of a Mtas index. Its methods are called by the search service and allow to create, open close and drop a Mtas index. It allows to add or delete a document from an index, as well as to perform queries on the index.</p>
</div>
<div class="paragraph">
<p>Each index is related to only one project, and every project can have only one index from a given search provider.</p>
</div>
<div class="paragraph">
<p>When adding a document to a Mtas index, the Lucene engine will use the class MtasUimaParser in order to find out which are the tokens and annotations to be indexed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MtasUimaParser</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The parser is responsible for creating a new TokenCollection to be used by Lucene, whenever a new document is being indexed. The token collection consists of all the tokens and annotations found in the document, which are transformed into Mtas tokens in order to be added to the Lucene index. The parser scans the document CAS and goes through all its annotations, finding out which ones are related to the annotation layers in the document&#8217;s project - those are the annotations to be indexed. Currently, the parser only indexes span type annotations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_recommendation"><a class="anchor" href="#sect_recommendation"></a>Recommenders system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For information on the different recommenders, please refer to <a href="user-guide.html#sect_projects_recommendation">user guide</a>.</p>
</div>
<div class="sect2">
<h3 id="_recommenders"><a class="anchor" href="#_recommenders"></a>Recommenders</h3>
<div class="paragraph">
<p>Recommenders provide the ability to generate annotation suggestions. Optionally, they can be trained based on existing annotations. Also optionally, they can be evaluated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>RecommendationEngineFactory</code> interface provides the API for implementing recommender types.</p>
</li>
<li>
<p>The <code>RecommendationEngine</code> interface provides the API for the actual recommenders produced by the factory.</p>
</li>
<li>
<p>The <code>RecommenderFactoryRegistry</code> interface and its default implementation <code>RecommenderFactoryRegistryImpl</code> serve as an access point to the different recommender types.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_suggestion_supports"><a class="anchor" href="#_suggestion_supports"></a>Suggestion supports</h3>
<div class="paragraph">
<p>Suggestion supports provide everything necessary to handle annotation suggestions. This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>extracting suggestions from the predicted annotations that the recommenders</p>
</li>
<li>
<p>rendering these suggestions</p>
</li>
<li>
<p>handling actions like accepting/correting, rejecting, or skipping suggestions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The subsystem is made up of the following main APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>SuggestionSupport</code> interface provides the API for handling different kinds of suggestions.</p>
</li>
<li>
<p>The <code>SuggestionSupportRegistry</code> interface and its default implementation <code>SuggestionSupportRegistryImpl</code> serve as an access point to the different recommender types.</p>
</li>
<li>
<p>The <code>SuggestionRenderer</code> interface provides the API for rendering suggestions into a <code>VDoc</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sect_recommender_tutorial"><a class="anchor" href="#sect_recommender_tutorial"></a>Implementing a custom recommender</h3>
<div class="paragraph">
<p>This section describes the overall design of internal recommenders in INCEpTION and gives a
tutorial on how to implement them. Internal recommenders are created by implementing relevant
Java interfaces and are added via Maven dependencies. These are then picked up during application
startup by the Spring Framework.</p>
</div>
<div class="paragraph">
<p>For this tutorial, we will add a recommender for named entities that uses the data majority label for
predicting, i.e. it predicts always the label that appears most often in the training data. The full
code for this example can be found in the <strong>inception-example-imls-data-majority</strong> module.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_the_environment"><a class="anchor" href="#_setting_up_the_environment"></a>Setting up the environment</h4>
<div class="paragraph">
<p>To get started, check out the most recent source code of INCEpTION from
<a href="https://github.com/inception-project/inception">Github</a> and import it as a Maven project in the IDE
of your choice. Add a new module to the INCEpTION project itself, we will call it
<strong>inception-example-imls-data-majority</strong>.</p>
</div>
<div class="paragraph">
<p>In the root <code>pom.xml</code> of the INCEpTION project, add your recommender as a dependency. Update
the version of the dependency entry you just created to the version you find in the <em>pom.xml</em> of the
INCEpTION project. It should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;
…
    &lt;dependency&gt;
        &lt;groupId&gt;de.tudarmstadt.ukp.inception.app&lt;/groupId&gt;
        &lt;artifactId&gt;inception-imls-data-majority&lt;/artifactId&gt;
        &lt;version&gt;37.6&lt;/version&gt;
    &lt;/dependency&gt;
…
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the same entry in <code>inception-app-webapp</code>, but omit the version number. It then uses automatically the
version in the parent POM file. Also add it to <code>usedDependencies</code> there.</p>
</div>
<div class="paragraph">
<p>To add a new recommender to INCEpTION, two classes need to be created. These are
described in the following.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_the_recommendationengine"><a class="anchor" href="#_implementing_the_recommendationengine"></a>Implementing the RecommendationEngine</h4>
<div class="paragraph">
<p>Recommenders give suggestions for possible annotations to the user. In order to do that,
they need to be able be to trained on existing annotations, predict annotations in a document and
be evaluated for a performance estimate. This is what the <code>RecommendationEngine</code> abstract class is for.
It defines the methods that are used to train, test and evaluate a machine learning algorithm and offers
several helper methods. Instances of this class often wrap external machine learning packages like
<a href="https://opennlp.apache.org/">OpenNLP</a> or <a href="https://deeplearning4j.org/">Deeplearning4j</a>.</p>
</div>
<div class="paragraph">
<p>Recommenders in INCEpTION heavily rely on <a href="https://uima.apache.org">Apache UIMA</a> types and features.
A recommender is configured for a certain layer and a certain feature. A layer can be seen as the
type of annotation you want to to, e.g. <code>POS</code>, <code>NER</code>. Layers correspond to UIMA types. A feature is
one piece of information that should be annotated, e.g. the POS tag. One layer can have many features.
When extending <code>RecommendationEngine</code>, the predicted layer/type can be obtained by <code>getPredictedType</code>,
the feature to predict respectively by <code>getPredictedFeature</code>.</p>
</div>
<div class="paragraph">
<p>Annotations are given to a recommender in the form of a
<a href="http://uima.apache.org/d/uimaj-current/apidocs/index.html">UIMA CAS</a>. One CAS corresponds to one
document in INCEpTION. Annotations from a CAS can be read and manipulated via the
<a href="https://uima.apache.org/d/uimafit-current/api/org/apache/uima/fit/util/CasUtil.html">CasUtil</a>.</p>
</div>
<div class="paragraph">
<p>We start by creating a new class <code>de.tudarmstadt.ukp.inception.recommendation.imls.datamajority.DataMajorityNerRecommender</code> that implements <code>RecommendationEngine</code>.
Please see the JavaDoc of the respective methods for their semantics.</p>
</div>
<div class="listingblock">
<div class="title">Class and member definition for the DataMajorityNerRecommender</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DataMajorityNerRecommender
    extends RecommendationEngine
{
    public static final Key&lt;DataMajorityModel&gt; KEY_MODEL = new Key&lt;&gt;("model");

    private static final Class&lt;Token&gt; DATAPOINT_UNIT = Token.class;

    private final Logger log = LoggerFactory.getLogger(getClass());

    public DataMajorityNerRecommender(Recommender aRecommender)
    {
        super(aRecommender);
    }

    /**
     * Given training data in {@code aCasses}, train a model. In order to save data between runs,
     * the {@code aContext} can be used. This method must not mutate {@code aCasses} in any way.
     * 
     * @param aContext
     *            The context of the recommender
     * @param aCasses
     *            The training data
     * @throws RecommendationException
     *             if there was a problem during training
     */
    public abstract void train(RecommenderContext aContext, List&lt;CAS&gt; aCasses)
        throws RecommendationException;

    /**
     * Given text in a {@link CAS}, predict target annotations. These should be written into
     * {@link CAS}. In order to restore data from e.g. previous training, the
     * {@link RecommenderContext} can be used.
     * 
     * @param aContext
     *            The context of the recommender
     * @param aCas
     *            The training data
     * @return Range in which the recommender generated predictions. No suggestions in this range
     *         should be inherited.
     * @throws RecommendationException
     *             if there was a problem during prediction
     */
    public Range predict(PredictionContext aContext, CAS aCas) throws RecommendationException
    {
        return predict(aContext, aCas, 0, aCas.getDocumentText().length());
    }

    /**
     * Given text in a {@link CAS}, predict target annotations. These should be written into
     * {@link CAS}. In order to restore data from e.g. previous training, the
     * {@link RecommenderContext} can be used.
     * &lt;p&gt;
     * Depending on the recommender, it may be necessary to internally extend the range in which
     * recommendations are generated so that recommendations that partially overlap the prediction
     * range may also be generated.
     * 
     * @param aContext
     *            The context of the recommender
     * @param aCas
     *            The training data
     * @param aBegin
     *            Begin of the range in which predictions should be generated.
     * @param aEnd
     *            End of the range in which predictions should be generated.
     * @return Range in which the recommender generated predictions. No suggestions in this range
     *         should be inherited.
     * @throws RecommendationException
     *             if there was a problem during prediction
     */
    public abstract Range predict(PredictionContext aContext, CAS aCas, int aBegin, int aEnd)
        throws RecommendationException;

    /**
     * Evaluates the performance of a recommender by splitting the data given in {@code aCasses} in
     * training and test sets by using {@code aDataSplitter}, training on the training set and
     * measuring performance on unseen data on the training set. This method must not mutate
     * {@code aCasses} in any way.
     * 
     * @param aCasses
     *            The CASses containing target annotations
     * @param aDataSplitter
     *            The splitter which determines which annotations belong to which set
     * @return Scores available through an EvaluationResult object measuring the performance of
     *         predicting on the test set
     * @throws RecommendationException
     *             if there was a problem during evaluation
     */
    public abstract EvaluationResult evaluate(List&lt;CAS&gt; aCasses, DataSplitter aDataSplitter)
        throws RecommendationException;

    private static class DataMajorityModel
    {
        private final String majorityLabel;
        private final double score;
        private final int numberOfAnnotations;

        private DataMajorityModel(String aMajorityLabel, double aScore, int aNumberOfAnnotations)
        {
            majorityLabel = aMajorityLabel;
            score = aScore;
            numberOfAnnotations = aNumberOfAnnotations;
        }
    }

    private static class Annotation
    {
        private final String label;
        private final double score;
        private final String explanation;
        private final int begin;
        private final int end;

        private Annotation(String aLabel, int aBegin, int aEnd)
        {
            this(aLabel, 0, 0, aBegin, aEnd);
        }

        private Annotation(String aLabel, double aScore, int aNumberOfAnnotations, int aBegin,
                int aEnd)
        {
            label = aLabel;
            score = aScore;
            explanation = "Based on " + aNumberOfAnnotations + " annotations";
            begin = aBegin;
            end = aEnd;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the constructor, we take the <code>Recommender</code> object which contains the recommender configuration,
e.g. the layer and the name of the feature to recommend. The next step is to implement the required
methods.</p>
</div>
<div class="paragraph">
<p><code>DataMajorityModel</code> and <code>Annotation</code> are internal data classes to simplify the code.</p>
</div>
<div class="sect4">
<h5 id="_recommendercontext"><a class="anchor" href="#_recommendercontext"></a>RecommenderContext</h5>
<div class="paragraph">
<p>Instances of <a href="https://github.com/inception-project/inception/blob/master/inception-recommendation-api/src/main/java/de/tudarmstadt/ukp/inception/recommendation/api/recommender/RecommenderContext.java">RecommendationEngine</a> itself are stateless. If data like trained models need to be
saved and loaded, it can be saved in the <code>RecommenderContext</code> that is given in the interface methods.
When needed again, e.g. for prediction, it then can be loaded again. The <code>Key</code> class is used in order
to ensure type safety.</p>
</div>
</div>
<div class="sect4">
<h5 id="_training"><a class="anchor" href="#_training"></a>Training</h5>
<div class="paragraph">
<p>Training consists of extracting annotations followed by training and saving the model. The
platform needs to know whether the recommender is ready for prediction, this is done by
overriding <code>RecommendationEngine::isReadyForPrediction</code>.</p>
</div>
<div class="listingblock">
<div class="title">Training routine</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public TrainingCapability getTrainingCapability()
{
    return TRAINING_REQUIRED;
}

@Override
public void train(RecommenderContext aContext, List&lt;CAS&gt; aCasses) throws RecommendationException
{
    List&lt;Annotation&gt; annotations = extractAnnotations(aCasses);

    DataMajorityModel model = trainModel(annotations);
    aContext.put(KEY_MODEL, model);
}

@Override
public boolean isReadyForPrediction(RecommenderContext aContext)
{
    return aContext.get(KEY_MODEL).map(Objects::nonNull).orElse(false);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Extracting annotations itself is done by iterating over all documents and selecting all annotations
for each. Here, we need to use the layer name and feature for which the recommender is configured
to extract the correct annotations.</p>
</div>
<div class="listingblock">
<div class="title">Extracting annotations from the documents</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private List&lt;Annotation&gt; extractAnnotations(List&lt;CAS&gt; aCasses)
{
    List&lt;Annotation&gt; annotations = new ArrayList&lt;&gt;();

    for (CAS cas : aCasses) {
        Type annotationType = CasUtil.getType(cas, layerName);
        Feature predictedFeature = annotationType.getFeatureByBaseName(featureName);

        for (AnnotationFS ann : CasUtil.select(cas, annotationType)) {
            String label = ann.getFeatureValueAsString(predictedFeature);
            if (isNotEmpty(label)) {
                annotations.add(new Annotation(label, ann.getBegin(), ann.getEnd()));
            }
        }
    }

    return annotations;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The training itself is done by counting the number of occurrences for each label that was seen in the
documents. The label is then the one which occurred the most in the training documents.</p>
</div>
<div class="listingblock">
<div class="title">Training the model</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private DataMajorityModel trainModel(List&lt;Annotation&gt; aAnnotations)
    throws RecommendationException
{
    Map&lt;String, Integer&gt; model = new HashMap&lt;&gt;();
    for (Annotation ann : aAnnotations) {
        int count = model.getOrDefault(ann.label, 0);
        model.put(ann.label, count + 1);
    }

    Map.Entry&lt;String, Integer&gt; entry = model.entrySet().stream()
            .max(Map.Entry.comparingByValue()).orElseThrow(
                    () -&gt; new RecommendationException("Could not obtain data majority label"));

    String majorityLabel = entry.getKey();
    int numberOfAnnotations = model.values().stream().reduce(Integer::sum).get();
    double score = (float) entry.getValue() / numberOfAnnotations;

    return new DataMajorityModel(majorityLabel, score, numberOfAnnotations);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also compute a dummy score here which is displayed in the UI and used for e.g. active learning.</p>
</div>
</div>
<div class="sect4">
<h5 id="_predicting"><a class="anchor" href="#_predicting"></a>Predicting</h5>
<div class="paragraph">
<p>The first thing we do when predicting is to load the model we saved during training. For every
candidate in the document, we assign the majority label, create a new annotation and add it to the <code>CAS</code>.
From there, it will be read by INCEpTION and displayed to the user.</p>
</div>
<div class="listingblock">
<div class="title">Predicting annotations for a CAS</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public Range predict(PredictionContext aContext, CAS aCas, int aBegin, int aEnd)
    throws RecommendationException
{
    var model = aContext.get(KEY_MODEL).orElseThrow(
            () -&gt; new RecommendationException("Key [" + KEY_MODEL + "] not found in context"));

    // Make the predictions
    var tokenType = CasUtil.getAnnotationType(aCas, DATAPOINT_UNIT);
    var candidates = selectOverlapping(aCas, tokenType, aBegin, aEnd);
    var predictions = predict(candidates, model);

    // Add predictions to the CAS
    var predictedType = getPredictedType(aCas);
    Feature scoreFeature = getScoreFeature(aCas);
    Feature scoreExplanationFeature = getScoreExplanationFeature(aCas);
    Feature predictedFeature = getPredictedFeature(aCas);
    Feature isPredictionFeature = getIsPredictionFeature(aCas);

    for (var ann : predictions) {
        var annotation = aCas.createAnnotation(predictedType, ann.begin, ann.end);
        annotation.setStringValue(predictedFeature, ann.label);
        annotation.setDoubleValue(scoreFeature, ann.score);
        annotation.setStringValue(scoreExplanationFeature, ann.explanation);
        annotation.setBooleanValue(isPredictionFeature, true);
        aCas.addFsToIndexes(annotation);
    }

    return new Range(candidates);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a document, we consider possible candidates for a named entity to be tokens that are upper case.
In a real recommender, the step of candidate extraction should be more elaborate than that, but for this
tutorial, it is sufficient.</p>
</div>
<div class="paragraph">
<p>When making predictions, we also set the score feature to put a number on the quality of the annotation.
The UIMA score feature to set can be obtained by calling <code>getScoreFeature</code> inside a <code>RecommendationEngine</code>.
When creating predictions, make sure to call <code>annotation.setBooleanValue(isPredictionFeature, true);</code> so
that INCEpTION knows it is a prediction, not a real annotation. In addition, we provide an explanation for
the score through the UIMA feature obtained by calling <code>getScoreExplanationFeature</code> inside a <code>RecommendationEngine</code>.</p>
</div>
<div class="listingblock">
<div class="title">Making the predictions</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private List&lt;Annotation&gt; predict(Collection&lt;AnnotationFS&gt; candidates, DataMajorityModel aModel)
{
    List&lt;Annotation&gt; result = new ArrayList&lt;&gt;();
    for (AnnotationFS token : candidates) {
        String tokenText = token.getCoveredText();
        if (tokenText.length() &gt; 0 &amp;&amp; !Character.isUpperCase(tokenText.codePointAt(0))) {
            continue;
        }

        int begin = token.getBegin();
        int end = token.getEnd();

        Annotation annotation = new Annotation(aModel.majorityLabel, aModel.score,
                aModel.numberOfAnnotations, begin, end);
        result.add(annotation);
    }

    return result;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the dummy score here from the training as the recommender score.</p>
</div>
</div>
<div class="sect4">
<h5 id="_evaluating"><a class="anchor" href="#_evaluating"></a>Evaluating</h5>
<div class="paragraph">
<p>When configuring a recommender, it can be specified that it needs to achieve a certain score
before the recommendations are shown to the user. For that, the platform regularly evaluates
recommenders in the background. We use macro-averaged F1-score as an evaluation score.
In code, the evaluation is implemented in the <code>evaluate</code> method.</p>
</div>
<div class="paragraph">
<p>Evaluation is done on a set of documents. In order to properly divide the annotations into training
and test set, a <code>DataSplitter</code> is given which tells you to which data set an annotation belongs.</p>
</div>
<div class="paragraph">
<p>For the actual evaluation, we collect the true label and the predicted majority label in a
<code>LabelPair</code> for each true label. A stream of these instances can then be collected with
the use of an <code>EvaluationResultCollector</code> as an <code>EvaluationResult</code> object - the result of the
evaluation. This object provides access to calculations for token-based accuracy, macro-averaged
precision, recall and F1-score. This F1-score is later used for
comparison with the user-defined threshold to activate the recommender.</p>
</div>
<div class="listingblock">
<div class="title">Evaluating the recommender</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
public EvaluationResult evaluate(List&lt;CAS&gt; aCasses, DataSplitter aDataSplitter)
    throws RecommendationException
{
    List&lt;Annotation&gt; data = extractAnnotations(aCasses);
    List&lt;Annotation&gt; trainingData = new ArrayList&lt;&gt;();
    List&lt;Annotation&gt; testData = new ArrayList&lt;&gt;();

    for (Annotation ann : data) {
        switch (aDataSplitter.getTargetSet(ann)) {
        case TRAIN:
            trainingData.add(ann);
            break;
        case TEST:
            testData.add(ann);
            break;
        case IGNORE:
            break;
        }
    }

    int trainingSetSize = trainingData.size();
    int testSetSize = testData.size();
    double overallTrainingSize = data.size() - testSetSize;
    double trainRatio = (overallTrainingSize &gt; 0) ? trainingSetSize / overallTrainingSize : 0.0;

    if (trainingData.size() &lt; 1 || testData.size() &lt; 1) {
        log.info("Not enough data to evaluate, skipping!");
        EvaluationResult result = new EvaluationResult(DATAPOINT_UNIT.getSimpleName(),
                getRecommender().getLayer().getUiName(), trainingSetSize, testSetSize,
                trainRatio);
        result.setEvaluationSkipped(true);
        return result;
    }

    DataMajorityModel model = trainModel(trainingData);

    // evaluation: collect predicted and gold labels for evaluation
    EvaluationResult result = testData.stream()
            .map(anno -&gt; new LabelPair(anno.label, model.majorityLabel))
            .collect(toEvaluationResult(DATAPOINT_UNIT.getSimpleName(),
                    getRecommender().getLayer().getUiName(), trainingSetSize, testSetSize,
                    trainRatio));

    return result;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_recommendationfactory"><a class="anchor" href="#_recommendationfactory"></a>RecommendationFactory</h4>
<div class="paragraph">
<p>The <code>RecommendationFactory</code> is used to create a new recommender instance. It also defines for which
types of layers and features the recommender itself can be used. Here, we decided to only support
token span layers without cross sentence annotations.</p>
</div>
<div class="listingblock">
<div class="title">The RecommendationFactory</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Component
public class DataMajorityRecommenderFactory
    extends RecommendationEngineFactoryImplBase&lt;Void&gt;
{
    // This is a string literal so we can rename/refactor the class without it changing its ID
    // and without the database starting to refer to non-existing recommendation tools.
    public static final String ID = "de.tudarmstadt.ukp.inception.recommendation.imls.datamajority.DataMajorityRecommender";

    @Override
    public String getId()
    {
        return ID;
    }

    @Override
    public RecommendationEngine build(Recommender aRecommender)
    {
        return new DataMajorityNerRecommender(aRecommender);
    }

    @Override
    public String getName()
    {
        return "Data Majority Recommender";
    }

    @Override
    public boolean accepts(AnnotationLayer aLayer)
    {
        if (aLayer == null) {
            return false;
        }

        return (asList(SINGLE_TOKEN, TOKENS).contains(aLayer.getAnchoringMode()))
                &amp;&amp; !aLayer.isCrossSentence() &amp;&amp; SpanLayerSupport.TYPE.equals(aLayer.getType());
    }

    @Override
    public boolean accepts(AnnotationFeature aFeature)
    {
        if (aFeature == null) {
            return false;
        }

        return accepts(aFeature.getLayer()) &amp;&amp; CAS.TYPE_NAME_STRING.equals(aFeature.getType())
                || aFeature.isVirtualFeature();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_external_recommender"><a class="anchor" href="#_external_recommender"></a>External recommender</h3>
<div class="sect3">
<h4 id="_external_recommender_api_overview"><a class="anchor" href="#_external_recommender_api_overview"></a>Overview</h4>
<div class="paragraph">
<p>This section describes the External Recommender API for INCEpTION. An external recommender is a
classifier whose functionality is exposed via a HTTP web service. It can predict annotations for
given documents and optionally be trained on new data. This document describes the endpoints a web
service needs to expose so it can be used with INCEpTION. The documents that are exchanged are in
form of a UIMA CAS. For sending, they have to be serialized to CAS XMI. For receiving, it has to be
deserialized back. There are two main libraries available that manage CAS handling, one is the
<a href="https://uima.apache.org">Apache UIMA Java SDK</a>, the other one <a href="https://github.com/dkpro/dkpro-cassis#dkpro-cassis">dkpro-cassis</a> (Python).</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_recommender_api_paths"><a class="anchor" href="#_external_recommender_api_paths"></a>API Endpoints</h4>
<div class="sect4">
<h5 id="_external_recommender_api_predictcas"><a class="anchor" href="#_external_recommender_api_predictcas"></a>Predict annotations for a single document</h5>
<div class="literalblock">
<div class="content">
<pre>POST /predict</pre>
</div>
</div>
<div class="sect5">
<h6 id="_description"><a class="anchor" href="#_description"></a>Description</h6>
<div class="paragraph">
<p>Sends a CAS together with information about the layer and feature to predict to the external recommender. The external recommender then returns the CAS annotated with predictions.</p>
</div>
</div>
<div class="sect5">
<h6 id="_parameters"><a class="anchor" href="#_parameters"></a>Parameters</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Type</th>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Body</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>body</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Document CAS for which annotations will be predicted</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_predictrequest">PredictRequest</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_responses"><a class="anchor" href="#_responses"></a>Responses</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 70%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">HTTP Code</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>200</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Successful prediction</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_predictresponse">PredictResponse</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_consumes"><a class="anchor" href="#_consumes"></a>Consumes</h6>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_produces"><a class="anchor" href="#_produces"></a>Produces</h6>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_tags"><a class="anchor" href="#_tags"></a>Tags</h6>
<div class="ulist">
<ul>
<li>
<p>predict</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_http_request"><a class="anchor" href="#_example_http_request"></a>Example HTTP request</h6>
<div class="sect6">
<h7 id="_request_path"><a class="anchor" href="#_request_path"></a>Request path</h7>
<div class="listingblock">
<div class="content">
<pre>/predict</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_request_body"><a class="anchor" href="#_request_body"></a>Request body</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "metadata" : {
    "layer" : "de.tudarmstadt.ukp.dkpro.core.api.ner.type.NamedEntity",
    "feature" : "value",
    "projectId" : 1337,
    "anchoringMode" : "tokens",
    "crossSentence" : false
  },
  "document" : {
    "xmi" : "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xmi:XMI xmlns:tcas=\"http:///uima/tcas.ecore\" xmlns:xmi=\"http://www.omg.org/XMI\" xmlns:cas=\"http:///uima/cas.ecore\" xmlns:cassis=\"http:///cassis.ecore\" xmi:version=\"2.0\"&gt; &lt;cas:NULL xmi:id=\"0\"/&gt; &lt;tcas:DocumentAnnotation xmi:id=\"8\" sofa=\"1\" begin=\"0\" end=\"47\" language=\"x-unspecified\"/&gt; &lt;cas:Sofa xmi:id=\"1\" sofaNum=\"1\" sofaID=\"mySofa\" mimeType=\"text/plain\" sofaString=\"Joe waited for the train . The train was late .\"/&gt; &lt;cas:View sofa=\"1\" members=\"8\"/&gt; &lt;/xmi:XMI&gt;",
    "documentId" : 42,
    "userId" : "testuser"
  },
  "typeSystem" : "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;typeSystemDescription xmlns=\"http://uima.apache.org/resourceSpecifier\"&gt; &lt;types&gt; &lt;typeDescription&gt; &lt;name&gt;uima.tcas.DocumentAnnotation&lt;/name&gt; &lt;description/&gt; &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt; &lt;features&gt; &lt;featureDescription&gt; &lt;name&gt;language&lt;/name&gt; &lt;description/&gt; &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt; &lt;/featureDescription&gt; &lt;/features&gt; &lt;/typeDescription&gt; &lt;/types&gt; &lt;/typeSystemDescription&gt;"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_example_http_response"><a class="anchor" href="#_example_http_response"></a>Example HTTP response</h6>
<div class="sect6">
<h7 id="_response_200"><a class="anchor" href="#_response_200"></a>Response 200</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "document" : "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xmi:XMI xmlns:tcas=\"http:///uima/tcas.ecore\" xmlns:xmi=\"http://www.omg.org/XMI\" xmlns:cas=\"http:///uima/cas.ecore\" xmlns:cassis=\"http:///cassis.ecore\" xmi:version=\"2.0\"&gt; &lt;cas:NULL xmi:id=\"0\"/&gt; &lt;tcas:DocumentAnnotation xmi:id=\"8\" sofa=\"1\" begin=\"0\" end=\"47\" language=\"x-unspecified\"/&gt; &lt;cas:Sofa xmi:id=\"1\" sofaNum=\"1\" sofaID=\"mySofa\" mimeType=\"text/plain\" sofaString=\"Joe waited for the train . The train was late .\"/&gt; &lt;cas:View sofa=\"1\" members=\"8\"/&gt; &lt;/xmi:XMI&gt;"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_external_recommender_api_trainrecommender"><a class="anchor" href="#_external_recommender_api_trainrecommender"></a>Train recommender on a set of documents</h5>
<div class="literalblock">
<div class="content">
<pre>POST /train</pre>
</div>
</div>
<div class="sect5">
<h6 id="_description_2"><a class="anchor" href="#_description_2"></a>Description</h6>
<div class="paragraph">
<p>Sends a list of CASses to the external recommender for training. No response body is expected.</p>
</div>
</div>
<div class="sect5">
<h6 id="_parameters_2"><a class="anchor" href="#_parameters_2"></a>Parameters</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 16.6666%;">
<col style="width: 50%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Type</th>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Body</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>body</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">List of documents CAS whose annotations will be used for training</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_train">Train</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_responses_2"><a class="anchor" href="#_responses_2"></a>Responses</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 70%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">HTTP Code</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>204</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Successful training</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">No Content</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>429</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Too many training requests have been sent, the sender should wait a while until the next request</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">No Content</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_consumes_2"><a class="anchor" href="#_consumes_2"></a>Consumes</h6>
<div class="ulist">
<ul>
<li>
<p><code>application/json</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_tags_2"><a class="anchor" href="#_tags_2"></a>Tags</h6>
<div class="ulist">
<ul>
<li>
<p>train</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_http_request_2"><a class="anchor" href="#_example_http_request_2"></a>Example HTTP request</h6>
<div class="sect6">
<h7 id="_request_path_2"><a class="anchor" href="#_request_path_2"></a>Request path</h7>
<div class="listingblock">
<div class="content">
<pre>/train</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_request_body_2"><a class="anchor" href="#_request_body_2"></a>Request body</h7>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "metadata" : {
    "layer" : "de.tudarmstadt.ukp.dkpro.core.api.ner.type.NamedEntity",
    "feature" : "value",
    "projectId" : 1337,
    "anchoringMode" : "tokens",
    "crossSentence" : false
  },
  "documents" : [ {
    "xmi" : "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xmi:XMI xmlns:tcas=\"http:///uima/tcas.ecore\" xmlns:xmi=\"http://www.omg.org/XMI\" xmlns:cas=\"http:///uima/cas.ecore\" xmlns:cassis=\"http:///cassis.ecore\" xmi:version=\"2.0\"&gt; &lt;cas:NULL xmi:id=\"0\"/&gt; &lt;tcas:DocumentAnnotation xmi:id=\"8\" sofa=\"1\" begin=\"0\" end=\"47\" language=\"x-unspecified\"/&gt; &lt;cas:Sofa xmi:id=\"1\" sofaNum=\"1\" sofaID=\"mySofa\" mimeType=\"text/plain\" sofaString=\"Joe waited for the train . The train was late .\"/&gt; &lt;cas:View sofa=\"1\" members=\"8\"/&gt; &lt;/xmi:XMI&gt;",
    "documentId" : 42,
    "userId" : "testuser"
  } ],
  "typeSystem" : "&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;typeSystemDescription xmlns=\"http://uima.apache.org/resourceSpecifier\"&gt; &lt;types&gt; &lt;typeDescription&gt; &lt;name&gt;uima.tcas.DocumentAnnotation&lt;/name&gt; &lt;description/&gt; &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt; &lt;features&gt; &lt;featureDescription&gt; &lt;name&gt;language&lt;/name&gt; &lt;description/&gt; &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt; &lt;/featureDescription&gt; &lt;/features&gt; &lt;/typeDescription&gt; &lt;/types&gt; &lt;/typeSystemDescription&gt;"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_recommender_api_definitions"><a class="anchor" href="#_external_recommender_api_definitions"></a>Definitions</h4>
<div class="sect4">
<h5 id="_external_recommender_api_document"><a class="anchor" href="#_external_recommender_api_document"></a>Document</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>documentId</strong><br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Identifier for this document. It is unique in the context of the project.<br>
<strong>Example</strong> : <code>42</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>userId</strong><br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Identifier for the user for which recommendations should be made.<br>
<strong>Example</strong> : <code>"testuser"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>xmi</strong><br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CAS as XMI<br>
<strong>Example</strong> : <code>"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xmi:XMI xmlns:tcas=\"http:///uima/tcas.ecore\" xmlns:xmi=\"http://www.omg.org/XMI\" xmlns:cas=\"http:///uima/cas.ecore\" xmlns:cassis=\"http:///cassis.ecore\" xmi:version=\"2.0\"&gt; &lt;cas:NULL xmi:id=\"0\"/&gt; &lt;tcas:DocumentAnnotation xmi:id=\"8\" sofa=\"1\" begin=\"0\" end=\"47\" language=\"x-unspecified\"/&gt; &lt;cas:Sofa xmi:id=\"1\" sofaNum=\"1\" sofaID=\"mySofa\" mimeType=\"text/plain\" sofaString=\"Joe waited for the train . The train was late .\"/&gt; &lt;cas:View sofa=\"1\" members=\"8\"/&gt; &lt;/xmi:XMI&gt;"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_external_recommender_api_metadata"><a class="anchor" href="#_external_recommender_api_metadata"></a>Metadata</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>anchoringMode</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Describes how annotations are anchored to tokens. Is one of 'characters', 'singleToken', 'tokens', 'sentences'.<br>
<strong>Example</strong> : <code>"tokens"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>crossSentence</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">True if the project supports cross-sentence annotations, else False<br>
<strong>Example</strong> : <code>false</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>feature</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Feature of the layer which should be predicted<br>
<strong>Example</strong> : <code>"value"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>layer</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Layer which should be predicted<br>
<strong>Example</strong> : <code>"de.tudarmstadt.ukp.dkpro.core.api.ner.type.NamedEntity"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>projectId</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">The id of the project to which the document(s) belong.<br>
<strong>Example</strong> : <code>1337</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_external_recommender_api_predictrequest"><a class="anchor" href="#_external_recommender_api_predictrequest"></a>PredictRequest</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>document</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Example</strong> : <code>"<a href="#_external_recommender_api_document">Document</a>"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_document">Document</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>metadata</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Example</strong> : <code>"<a href="#_external_recommender_api_metadata">Metadata</a>"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_metadata">Metadata</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>typeSystem</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Type system XML of the CAS<br>
<strong>Example</strong> : <code>"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;typeSystemDescription xmlns=\"http://uima.apache.org/resourceSpecifier\"&gt; &lt;types&gt; &lt;typeDescription&gt; &lt;name&gt;uima.tcas.DocumentAnnotation&lt;/name&gt; &lt;description/&gt; &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt; &lt;features&gt; &lt;featureDescription&gt; &lt;name&gt;language&lt;/name&gt; &lt;description/&gt; &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt; &lt;/featureDescription&gt; &lt;/features&gt; &lt;/typeDescription&gt; &lt;/types&gt; &lt;/typeSystemDescription&gt;"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_external_recommender_api_predictresponse"><a class="anchor" href="#_external_recommender_api_predictresponse"></a>PredictResponse</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>document</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CAS with annotations from the external recommender as XMI<br>
<strong>Example</strong> : <code>"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xmi:XMI xmlns:tcas=\"http:///uima/tcas.ecore\" xmlns:xmi=\"http://www.omg.org/XMI\" xmlns:cas=\"http:///uima/cas.ecore\" xmlns:cassis=\"http:///cassis.ecore\" xmi:version=\"2.0\"&gt; &lt;cas:NULL xmi:id=\"0\"/&gt; &lt;tcas:DocumentAnnotation xmi:id=\"8\" sofa=\"1\" begin=\"0\" end=\"47\" language=\"x-unspecified\"/&gt; &lt;cas:Sofa xmi:id=\"1\" sofaNum=\"1\" sofaID=\"mySofa\" mimeType=\"text/plain\" sofaString=\"Joe waited for the train . The train was late .\"/&gt; &lt;cas:View sofa=\"1\" members=\"8\"/&gt; &lt;/xmi:XMI&gt;"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_external_recommender_api_train"><a class="anchor" href="#_external_recommender_api_train"></a>Train</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 61.1111%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-middle">Name</th>
<th class="tableblock halign-left valign-middle">Description</th>
<th class="tableblock halign-left valign-middle">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>documents</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">CAS as XMI<br>
<strong>Example</strong> : <code>[ "<a href="#_external_recommender_api_document">Document</a>" ]</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&lt; <a href="#_external_recommender_api_document">Document</a> &gt; array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>metadata</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Example</strong> : <code>"<a href="#_external_recommender_api_metadata">Metadata</a>"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="#_external_recommender_api_metadata">Metadata</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>typeSystem</strong><br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Type system XML of the CAS<br>
<strong>Example</strong> : <code>"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;typeSystemDescription xmlns=\"http://uima.apache.org/resourceSpecifier\"&gt; &lt;types&gt; &lt;typeDescription&gt; &lt;name&gt;uima.tcas.DocumentAnnotation&lt;/name&gt; &lt;description/&gt; &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt; &lt;features&gt; &lt;featureDescription&gt; &lt;name&gt;language&lt;/name&gt; &lt;description/&gt; &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt; &lt;/featureDescription&gt; &lt;/features&gt; &lt;/typeDescription&gt; &lt;/types&gt; &lt;/typeSystemDescription&gt;"</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_encoding_annotation_suggestions"><a class="anchor" href="#_encoding_annotation_suggestions"></a>Encoding annotation suggestions</h4>
<div class="paragraph">
<p>This section explains how annotation suggestions can be encoded in the response to a <code>predict</code> call.</p>
</div>
<div class="paragraph">
<p>Note that a recommender can only produce suggestions for one feature on one layer. The name of the layer and feature are contained in the request to the <code>predict</code> call and only suggestions generated for that specific layer and feature will be processed by INCEpTION when the call returns.</p>
</div>
<div class="paragraph">
<p>For the purpose of producing annotation suggestions, this specific layer is extended with additional features that can be set. Some of these features start with the name of the feature (we use <code>&lt;FEATURE_NAME&gt;</code> as a placeholder for the actual feature name below) to be predicted and then add a suffix:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>inception_internal_predicted</code>: this boolean feature indicates that an annotation was added by the external recommender. It allows the system to distinguish between annotations that already existed in the document and annotations that the recommender has created. Only annotations where this flag is set to <code>true</code> will be processed by INCEpTION.</p>
</li>
<li>
<p><code>&lt;FEATURE_NAME&gt;</code>: this feature takes the label that the external recommender assigns.</p>
</li>
<li>
<p><code>&lt;FEATURE_NAME&gt;_score</code> (optional): this floating-point (double) feature can be used to indicate the score assigned to a predicted label.</p>
</li>
<li>
<p><code>&lt;FEATURE_NAME&gt;_score_explanation</code> (optional): this string feature can be used to provide an explanation for the score. This explanation is shown on the annotation page when the user inspects a particular suggestion (note that not all editors may support displaying explanations).</p>
</li>
<li>
<p><code>&lt;FEATURE_NAME&gt;_auto_accept</code> (optional): this feature can be set to <code>on-first-access</code> to force-accept an annotation into a document when an annotator accesses a document for the first time. This should only be used in conjunction with non-trainable recommenders and with the option <strong>Wait for suggestions from non-trainable recommenders when opening document</strong> in the recommender project settings. Thus, when an annotator opens a document for the first time, the system would wait for recommendations by non-trainable (pre-trained) recommenders and then directly accept any of the suggestions that the recommender has marked to uto-accept on-first-access. When the annotator resets a document via the action bar, this procedure is also followed. This provides a convenient way of "pre-annotating" documents with the help of external recommenders. Note though that an annotator has to actually open a document in order for this process to trigger.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_activeLearning"><a class="anchor" href="#sect_activeLearning"></a>Active Learning</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The active learning module aims to guide the user through recommendations in such a way that the
the judgements made by the user are most informative to the recommenders. The goal is to reduce
the required user interactions to a minimum. The module consists of the following classes and
interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ActiveLearningService</code> interface and its default implementation <code>ActiveLearningServiceImpl</code>
which provide access to the ranked suggestions.</p>
</li>
<li>
<p>The <code>ActiveLearningStrategy</code> interface which allows plugging in different sampling strategies.</p>
</li>
<li>
<p>The <code>UncertaintySamplingStrategy</code> class which is currently the only sampling strategy available.</p>
</li>
<li>
<p>The <code>ActiveLearningSidebar</code> class which provides the active learning sidebar for the annotation
page. Here the user can accept/reject/correct/skip suggestions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The active learning module relies on the recommendation module for the actual annotation
recommendations. This means that the active learning module does not directly make use of the
user feedback. If suggestions are accepted, they are used in the next train/predict run of the
recommendation module as training data. The active learning module then samples the new annotation
suggestions from this run and updates the order in which it offers the suggestions to the user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./developer-guide/diag-plantuml-md5-a06cf7943ca7daddfb1cc80682508375.png" alt="Diagram" width="777" height="550">
</div>
</div>
<div class="ulist">
<div class="title">Events</div>
<ul>
<li>
<p><code>ActiveLearningSuggestionOfferedEvent</code> - active learning has pointed the user at a recommentation</p>
</li>
<li>
<p><code>ActiveLearningRecommendationEvent</code> - user has accepted/rejected a recommendation</p>
</li>
<li>
<p><code>ActiveLearningSessionStartedEvent</code> - user has opened an active learning session</p>
</li>
<li>
<p><code>ActiveLearningSessionCompletedEvent</code> - user has closed the active learning session</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_sampling_strategies"><a class="anchor" href="#_sampling_strategies"></a>Sampling strategies</h3>
<div class="sect3">
<h4 id="sect_activeLearning_uncertaintySampling"><a class="anchor" href="#sect_activeLearning_uncertaintySampling"></a>Uncertainty sampling</h4>
<div class="paragraph">
<p>Currently, there is only a single sampling strategy, namely the <code>UncertaintySamplingStrategy</code>. It
it compares the scores of the annotation suggestion. The smaller the difference between
the best and the second best score, the earlier the suggestion is proposed to the user. The
scores produced by different recommenders can be on different scales and are therefore
not really comparable. Thus, the strategy only compares suggestions from the same recommender to
each other. So if recommender A produces two suggestions X and Y, they are compared to each other.
However, if there are two recommenders A and B producing each one suggestion X and Y, then X and Y
are not compared to each other.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_log"><a class="anchor" href="#sect_log"></a>Event Log</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The event logging module allows catching Spring events and logging them them to the
database. It consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>EventRepository</code> interface and its default implementation <code>EventRepositoryImpl</code> which
serve as the data access layer for logged events.</p>
</li>
<li>
<p>The <code>EventLoggingListener</code> which hooks into Spring, captures events, and then uses the
<code>EventRepository</code> to log them.</p>
</li>
<li>
<p>The <code>EventLoggingAdapter</code> interface. Spring components implementing this interface are
used to extract information from Spring events and to convert them into a format
suitable to be logged.</p>
</li>
<li>
<p>The <code>LoggedEvent</code> entity class which maps the logged events to the database.</p>
</li>
<li>
<p>The <code>LoggedEventExporter</code> and <code>ExportedLoggedEvent</code> which are used to export/import the
event log as part of a project export/import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log module comes with a number of adapters for common events such as annotation
manipulation, changes to the project configuration, etc. Any event for which no specific
adapter exists is handled using the <code>GenericEventAdapter</code> which logs only general
information (e.g. the timestamp, current user, type of event) but no event-specific
details (e.g. current project, current document, or even more specific details). Note that
even the <code>GenericEventAdapter</code> skips logging certain Spring events related to session
management, authorization, and the Spring context life-cycle.</p>
</div>
<div class="sect2">
<h3 id="sect_log_adapter"><a class="anchor" href="#sect_log_adapter"></a>Event Logging Adapters</h3>
<div class="paragraph">
<p>New logging adapters should be created in the module which provides the event they are logging.
Logging adapters for events generated outside INCEpTION (i.e. in upstream code) are usually
added to the log module itself.</p>
</div>
<div class="paragraph">
<p>To add support for a logging a new event, create a Spring component class which implements the
<code>EventLoggingAdapter</code> interface. Implement the following methods depending on the context in which
the event is triggered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getProject(Event)</code> if the event is triggered in the context of a specific project (applies to most
events);</p>
</li>
<li>
<p><code>getDocument(Event)</code> if the event is related to a specific source document (e.g. applies to
events triggered during annotation).</p>
</li>
<li>
<p><code>getDocument(Event)</code> if the event is related to a specific annotator (e.g. applies to
events triggered during annotation).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods <code>getEvent</code>, <code>getUser</code> and <code>getCreated</code> normally do not need to be implemented.</p>
</div>
<div class="paragraph">
<p>Most event adapters implement the <code>getDetails</code> method. This method must return a JSON string which
contains any relevant information about the event not covered by the methods above. E.g. for an
annotation manipulation event, it would contain information helping to identify the annotation and
the state before and after the manipulation. In order to generate this JSON string, the adapter
typically contains an inner class called <code>Details</code> to which the detail information from the event
is copied and which is then serialized to JSON using <code>JSONUtil.toJsonString(&#8230;&#8203;)</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_knowledgebase"><a class="anchor" href="#sect_knowledgebase"></a>Knowledge base</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect_knowledgebase_irischema"><a class="anchor" href="#sect_knowledgebase_irischema"></a>Schema mapping</h3>
<div class="paragraph">
<p>An IRI Schema defines the following attributes that are used for making queries in a knowledge base.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Schema Mapping Attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of resources that are classes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:Class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subclass IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a <strong>subclass of</strong> relation between classes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:subClassOf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines which class a resource belongs to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdf:type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Label IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a human readable label for a class or instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a description for a class or instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:comment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of resources that are properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdf:Property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subproperty IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a <strong>subproperty of</strong> relation between properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:subPropertyOf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Label IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a human readable label for a property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:label</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Description IRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property that defines a description for a property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rdfs:comment</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are multiple classes in the knowledge base module that model the IRI Schema of a knowledge
base. All the classes share that they have a single class-attribute for each IRI in the IRI Schema.
However each class has a different use case. The relevant classes are shown <a href="#KBClasses">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the structure of the general IRI Schema is changed (e.g. a new attribute is added) all
      the classes need to be adjusted.*
</td>
</tr>
</table>
</div>
<table id="KBClasses" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Knowledge base &amp; schema mapping classes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KnowledgeBase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General model for a knowledge base in frontend and backend components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KnowledgeBaseProfile</code> and  <code>KnowledgeBaseMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read pre-configured knowledge base profiles from a yaml file.
  The actual IRI Schema is modeled in KnowledgeBaseMapping.java.
  The yaml file is located at: <code>&#8230;&#8203;/inception-kb/src/main/resources/de/tudarmstadt/ukp/inception/kb/knowledgebase-profiles.yaml</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SchemaProfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines some specific IRI Schemas (e.g RDF, WIKIDATA, SKOS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExportedKnowledgeBase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Export a knowledge base configuration when a project is exported.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_conceptlinking"><a class="anchor" href="#sect_conceptlinking"></a>Concept Linking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The concept linking module is used to find items from a knowledge base that match a certain query
and context. It is used e.g. by the <code>ConceptFeatureEditor</code> to display items which match a concept
mention and it can use the mention&#8217;s context to rank (and optimally disambiguate) the candidate
items. It can also be used for non-contextualized queries, e.g. via the search field on the
knowledge base browsing page. The module consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ConceptLinkingService</code> interface and its default implementation <code>ConceptLinkingServiceImpl</code> which
is the main entry point for locating KB items.</p>
</li>
<li>
<p>The <code>EntityRankingFeatureGenerator</code> interface. Spring beans which implement this interface are
automatically picked up by the <code>ConceptLinkingServiceImpl</code> and used to rank candidates.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_ranking"><a class="anchor" href="#_ranking"></a>Ranking</h3>
<div class="sect3">
<h4 id="_feature_generators"><a class="anchor" href="#_feature_generators"></a>Feature generators</h4>
<div class="paragraph">
<p>The module currently uses primarily the <code>LevenshteinFeatureGenerator</code> which calculate the Levenshtein
distance between the mention text and the KB item label as well as between the query text (e.g.
entered into the auto-complete field of the <code>ConceptFeatureEditor</code>) and the KB item label.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ranking_strategy"><a class="anchor" href="#_ranking_strategy"></a>Ranking strategy</h4>
<div class="paragraph">
<p>The ranking method is currently hard-coded in <code>ConceptLinkingServiceImpl.baseLineRankingStrategy()</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_named_entity_linking_recommender"><a class="anchor" href="#_named_entity_linking_recommender"></a>Named entity linking recommender</h3>
<div class="paragraph">
<p>The module also includes the <code>NamedEntityLinker</code> recommender which can be used to generate annotation
recommendations. It gets triggered for any <code>NamedEntity</code> annotations and suggests which KB items to
link them to.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_external_editors"><a class="anchor" href="#sect_external_editors"></a>External Editors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section introduces the mechanism for registering external editors in INCEpTION. An external
editor is an editor plugin implemented in JavaScript / TypeScript.</p>
</div>
<div class="paragraph">
<p>In order to use an external editor, create a folder <code>editors</code> in the INCEpTION home folder, then
within that folder create another folder for the editor plugin. The name of the folder will be the
identifier of the editor plugin (e.g. if you would later rename the folder, the editor ID saved
in the editor user preference would become invalid).</p>
</div>
<div class="paragraph">
<p>Within the editor folder, create a plugin descriptor file named <code>plugin.json</code>. This file contains all
important information required by INCEpTION to use the editor.</p>
</div>
<div class="paragraph">
<p>The way the plugin descriptor needs to be set up depends mainly on whether the editor plugin takes
care of rendering the full document or only the annotations. However, some settings are generic
for any type of editor plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: the human-readable name for the editor</p>
</li>
<li>
<p><code>factory</code>: the JavaScript expression to access the annotation editor factory provided by the plugin</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>plugin.json</code> for external editor</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "My Editor (external)",
  "factory": "MyEditor.factory()",
  "view": "iframe:cas+xhtml+xml",
  "scripts": [
    "dist/MyEditor.min.js"
  ],
  "stylesheets": [
    "dist/MyEditor.min.css"
  ]
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_document_rendering_editors"><a class="anchor" href="#_document_rendering_editors"></a>Document-rendering editors</h3>
<div class="paragraph">
<p>A document-rendering editor loads the document and annotation data from the backend and then renders
the document including the annotations. This is typically the case for editors using SVG to display
the document. The editor has the ability to define the layout of the document in such a ways that
the annotations fit nicely.</p>
</div>
<div class="paragraph">
<p>For document-rendering editors, the <code>plugin.json</code> file offers the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>view</code>: the HTML file used as a template for the editor plugin. The value must start with <code>plugin:</code>
followed by a path to the HTML file within the plugin. E.g. if a template file <code>editor.html</code> is next
to the <code>plugin.json</code> file in the same folder, use <code>plugin:editor.html</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>plugin.json</code> for document-rendering editor</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "My Editor (external)",
  "factory": "MyEditor.factory()"
  "view": "plugin:editor.html"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The external editor mechanism loads the template file within an IFrame that is embedded in the
annotation page. Any CSS or JavaScript files needed by the plugin must be referenced by the template
file using a relative location. For example let&#8217;s assume a file <code>editor.html</code> which needs to load
a <code>editor.css</code> style sheet and an <code>editor.js</code> JavaScript file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;meta charset="utf-8"&gt;
&lt;title&gt;DoccanoSequenceEditor demo&lt;/title&gt;
&lt;script src="./editor.js"&gt;&lt;/script&gt;
&lt;link rel="stylesheet" href="./editor.css"&gt;
&lt;div id="editor"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_editors_using_server_side_document_views"><a class="anchor" href="#_editors_using_server_side_document_views"></a>Editors using server-side document views</h3>
<div class="paragraph">
<p>Some annotation editors overlay their annotations on an already existing document view. For example,
annotations could be overlaid on a HTML or PDF document. In this case, the external editor mechanism
can be configured to use a particular <code>DocumentView</code> plugin on the server to render the document and
to display it within an IFrame that is embedded in the annotation page. The editor plugin JavaScript
and CSS stylesheet files required are then injected into this IFrame as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "My editor",
  "factory": "MyEditor.factory()",
  "view": "iframe:cas+html,
  "scripts": [ "editor.js" ],
  "stylesheets": [ "editor.css" ],
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_views"><a class="anchor" href="#_views"></a>Views</h3>
<div class="paragraph">
<p>Currently supported views are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>iframe:cas+xml</code>: Renders XML contained in the CAS into a generic XML IFrame in the editor area.</p>
</li>
<li>
<p><code>iframe:cas+xhtml+xml</code>: Renders XML contained in the CAS into an XHTML+XML IFrame in the editor area.
HTML head and body elements are added automatically. The XML is rendered into the body.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_policies"><a class="anchor" href="#_policies"></a>Policies</h3>
<div class="paragraph">
<p>Every editor should provide a <code>policy.yaml</code> right next to the <code>plugin.json</code>. The <code>policy.yaml</code> declares
all elements and attributes that are supported by the editor. This policy file should be written as
a <strong>safelist</strong>, i.e. it should say exactly what is permitted instead of saying what is not allowed.
Allowing the wrong elements and attributes may cause security problems, e.g. if they can contain
executable JavaScript or load data from remote locations.</p>
</div>
<div class="paragraph">
<p>There are several elements like <code>script</code>, <code>meta</code>, <code>applet</code>, <code>link</code>, <code>iframe</code> as well as <code>a</code> which are
and JavaScript event attributes always filtered out.</p>
</div>
<div class="paragraph">
<p>If an editor does not provide a <code>policy.yaml</code> file, a default built-in policy is used which allows
most HTML formatting elements.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>policy.yaml</code> file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">name: Example policy
version: 1.0
case_sensitive: false
default_attribute_action: DROP
default_element_action: DROP
debug: false
policies:
  - { elements: ["html"], action: "PASS" }
  - { elements: ["p", "div"], action: "PASS" }
  - { elements: ["tr", "th"], action: "PASS" }
  - { attributes: ["class"], action: "PASS" }
  - { attributes: ["style"], action: "DROP" }
  - {
      attributes: ["title"],
      matching: "[a-zA-Z0-9]*",
      on_elements: ["div"],
      action: "PASS",
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two types of policies: <strong>element policies</strong>, and <strong>attribute policies</strong>.</p>
</div>
<div class="sect3">
<h4 id="_element_policies"><a class="anchor" href="#_element_policies"></a>Element policies</h4>
<div class="paragraph">
<p>An element policy must contain the key <code>elements</code> which takes a list of element names and the key
<code>action</code> which can be either <code>PASS</code> or <code>DROP</code>. If an element is dropped, all child elements are
also dropped. Text within the child elements is replaced by an equivalent amount of space such that
offsets are not affected.</p>
</div>
<div class="paragraph">
<p>Note that the root element of your documents should always be allowed to <code>PASS</code>, otherwise the
document may fail to render.</p>
</div>
<div class="paragraph">
<p>It is possible to preserve elements within dropped elements by explicitly allowing the nested
elements to <code>PASS</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">policies:
  - { elements: ["root", "child2"], action: "PASS" }
  - { elements: ["child1"], action: "DROP" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this policy, a document <code>&lt;root&gt;&lt;child1&gt;&lt;child2&gt;text&lt;/child2&gt;&lt;/child1/&gt;&lt;/root&gt;</code> will be transformed
to <code>&lt;root&gt;&lt;child2&gt;text&lt;/child2&gt;&lt;/root&gt;</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attribute_policies"><a class="anchor" href="#_attribute_policies"></a>Attribute policies</h4>
<div class="paragraph">
<p>An attribute policy must contain the key <code>attributes</code> which takes a list of attribute names,
and the key <code>action</code> which can be either <code>PASS</code> or <code>DROP</code>. Optionally it may contain the the key
<code>onElements</code> which takes a list of element names. If this key is present, the policy only affects
the attributes on the given elements, otherwise the policy affects all elements globally. Also, the
key <code>matching</code> can be optionally included to affect only attributes whose value matches the regular
expression provided as the value to <code>matching</code>.</p>
</div>
<div class="paragraph">
<p>When declaring attribute policies, the order matters. E.g. you should declare more specific policies
(e.g. such having a <code>onElements</code> or <code>matching</code> key) before less specific or global policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="_debugging"><a class="anchor" href="#_debugging"></a>Debugging</h4>
<div class="paragraph">
<p>To debug the rules, you can set the key <code>debug</code> to <code>true</code> and reload your editor in the browser.
Restarting the whole application is not required. When inspecting the content of the editor IFrame
in the browser&#8217;s developer tools, you will see that elements and attributes matched by a <code>DROP</code>
policy have been prefixed with <code>MASKED-</code> instead of being fully dropped. Do not forget to set
debug back to <code>false</code> or to remove the key for actual use.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_editor_implementation"><a class="anchor" href="#_editor_implementation"></a>Editor implementation</h3>
<div class="paragraph">
<p>Editors can be implemented in JavaScript or languages that can be compiled to JavaScript such as
TypeScript. To facilitate the implementation, INCEpTION provides a set of interface definitions for
TypeScript, in particular <code>AnnotationEditorFactory</code> and <code>AnnotationEditor</code>.</p>
</div>
<div class="paragraph">
<p>To make use of these, set up a <code>package.json</code> file next to the <code>plugin.json</code> file. In the <code>package.json</code>
file, add <code>@inception-project/inception-js-api</code> as a dependency. The example below also already includes
TypeScript and ESBuild as dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "My Editor",
  "version": "0.0.1",
  "scripts": {
    "build": "esbuild src/main.ts --target=es6 --bundle --sourcemap --global-name=MyEditor --outfile=editor.js"
  },
  "dependencies": {
    "@inception-project/inception-js-api": "*"
  },
  "devDependencies": {
    "esbuild": "^0.13.12",
    "typescript": "^4.4.2"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>@inception-project/inception-js-api</code> module should eventually be available from the NPMJS. However, if you
    have INCEpTION checked out locally, you may want to build your editor against the latest local version. To do this,
    first build INCEpTION once e.g. using <code>mvn clean install</code> or within your IDE. Then go to the folder
    <code>inception-application/inception/inception-js-api/src/main/ts</code> in your checkout and run <code>npm link</code>. After that, go to the
    folder containing your editor plugin and run <code>npm link "@inception-project/inception-js-api"</code> there.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The minimal editor implementation consists of three JavaScript/TypeScript files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>main.ts</code>: the entry point into your editor module. It is referenced by the <code>build</code> script in the
<code>package.json</code> file and provides access to your editor factory.</p>
</li>
<li>
<p><code>MyEditorFactory.ts</code>: a factory class implementing the <code>AnnotationEditorFactory</code> interface which facilitates
access to your editor for the external editor mechanism. In particular, it provides means of
instantiating and destroying an editor instance.</p>
</li>
<li>
<p><code>MyEditor.ts</code>: the actual editor class implementing the <code>AnnotationEditor</code> interface.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>main.ts</code> file skeleton</div>
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import { MyEditorFactory } from './MyEditorFactory';

const INSTANCE = new MyEditorFactory();

export function factory(): MyEditorFactory {
  return INSTANCE;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>MyEditorFactory.ts</code> file skeleton</div>
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import type { AnnotationEditorFactory, AnnotationEditorProperties, DiamClientFactory } from "@inception-project/inception-js-api"

const PROP_EDITOR = "__editor__";

export class MyEditorFactory implements AnnotationEditorFactory {
  public async getOrInitialize(element: HTMLElement, diam : DiamClientFactory, props: AnnotationEditorProperties): Promise&lt;RecogitoEditor&gt; {
    if (element[PROP_EDITOR] != null) {
      return element[PROP_EDITOR];
    }

    const ajax = diam.createAjaxClient(props.diamAjaxCallbackUrl);
    const bodyElement = document.getElementsByTagName("body")[0];
    element[PROP_EDITOR] = new MyEditor(bodyElement, ajax);
    return element[PROP_EDITOR];
  }

  public destroy(element: HTMLElement) {
    if (element[PROP_EDITOR] != null) {
      element[PROP_EDITOR].destroy();
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>MyEditor.ts</code> file skeleton</div>
<div class="content">
<pre class="highlight"><code class="language-typescript" data-lang="typescript">import type { AnnotationEditor, DiamAjax } from "@inception-project/inception-js-api";

const ANNOTATIONS_SERIALIZER = "Brat"; // The annotation format requested from the server

export class RecogitoEditor implements AnnotationEditor {
  private ajax: DiamAjax;

  public constructor(element: HTMLElement, ajax: DiamAjax) {
    this.ajax = ajax;

    // Add editor code here - usually the editor code would be in a set of additional classes which would be
    // instantiated and configured here and be bound to the given HTML element. Also, you would typically
    // register event handlers here that call methods like `createAnnotation` and `selectAnnotation` below, e.g.
    // when marking some text or clicking on an existing annotation.

    this.loadAnnotations();
  }

  public loadAnnotations(): void {
    this.ajax.loadAnnotations(ANNOTATIONS_SERIALIZER)
      .then(data =&gt; {
        // Place code here that causes your editor to re-render itself using the data received from the server
      });
  }

  public destroy(): void {
    // Depending on your editor implementation, it may be necessary to clean up stuff, e.g. to prevent memory leaks.
    // Do these cleanup actions here.
  }

  private createAnnotation(annotation): void {
    // This is an example event handler to be called by your editor. For example, it could pick up start and end offsets
    // of the text to be annotated as well as the annotated text itself and send these to the server using the DIAM AJAX API
    // that was injected by the exsternal editor mechanism. The server will update its state and send a `loadAnnotations()`
    // call to the browser to trigger a re-rendering.
    this.ajax.createSpanAnnotation([[annotation.begin, annotation.end]], annotation.text);
  }

  private selectAnnotation(annotation): void {
    // This is an example event handler to be called by your editor. For example, it could pick up the annotation ID from
    // the selected annotation and send it to the server using the DIAM AJAX API that was injected by the external editor
    // mechanism. The server will update its state and send a `loadAnnotations()` call to the browser to trigger a re-rendering.
    this.ajax.selectAnnotation(annotation.id);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_pdf_editor_dev"><a class="anchor" href="#sect_pdf_editor_dev"></a>PDF Annotation Editor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PDF-Editor module allows the view and annotation of PDF documents.</p>
</div>
<div class="paragraph">
<p>The module consists of several parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>VisualPdfReader</code> is using <em>pdfbox</em>  to extract the text from the PDF files. During this process,
it keeps track of the positions of each glyph (the "visual model") and also includes this
information as annotations  in the CAS. The <code>org.dkpro.core.api.pdf.type.PdfPage</code> type encodes
information about page boundaries while the <code>org.dkpro.core.api.pdf.type.PdfChunk</code> type encodes
information about short sequences of glyphs that have the same orientation and script direction
(typically belonging to the same word).</p>
</li>
<li>
<p>the <code>PdfDocumentFrameView</code> is using <em>pdf.js</em> to display the PDF file in the browser. It provides
endpoints for the browser to access the PDF as well as for obtaining the visual model.</p>
</li>
<li>
<p>the <code>PdfAnnotationEditor</code> which builds on the <code>PdfDocumentFrameView</code> and includes the client-side
JavaScript code (loosely based on <em>PDFAnno</em>). For the communication of the editor with the
backend, the INCEpTION JS editor API (DIAM) is used.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect_pdf_editor_legacy_dev"><a class="anchor" href="#sect_pdf_editor_legacy_dev"></a>PDF Annotation Editor (legacy)</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Legacy feature. To use this functionality, you need to enable it first by adding <code>ui.pdf-legacy.enabled=true</code> to the <code>settings.properties</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Support for this feature will be removed in a future version. The replacement is <a href="#sect_pdf_editor_dev">PDF Annotation Editor</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The PDF-Editor module allows the view and annotation of PDF documents.
This is implemented using <em>PDFAnno</em>, <em>PDFExtract</em> and <em>DKPro PDF Reader</em>.
The choice for <em>PDFAnno</em> and other implementation choices
are explained in the following.</p>
</div>
<div class="sect2">
<h3 id="_selecting_a_pdf_annotation_tool"><a class="anchor" href="#_selecting_a_pdf_annotation_tool"></a>Selecting a PDF Annotation Tool</h3>
<div class="paragraph">
<p>There are only few requirements to a PDF annotation tool for integration into
<em>INCEpTION</em>.
It must provide support for span and relation annotations and
it should also be lightweight and easily modifiable to fit into <em>INCEpTION</em>.</p>
</div>
<div class="paragraph">
<p>There are two PDF annotation tools up for discussion.
The first one is <a href="https://github.com/paperai/pdfanno"><em>PDFAnno</em></a> and the second
is <a href="https://github.com/hypothesis"><em>Hypothes.is</em></a>.
Both tools are web-based and open source software available on <em>GitHub</em>.</p>
</div>
<div class="paragraph">
<p><em>PDFAnno</em> is a lightweight annotation tool that only supports the PDF format.
It was created specifically to solve the lack of free open source software for
annotating PDF documents which is also capable of creating relations between
annotations. This is described in the publication about <em>PDFAnno</em> by
<a href="https://aclweb.org/anthology/L18-1175">Shindo et al</a>.</p>
</div>
<div class="paragraph">
<p><em>Hypothes.is</em> is a project that was created to provide an annotation layer
over the web. The idea is to be able to create annotations for all content
available on the internet and to share it with other people.
Hence <em>Hypothes.is</em> provides the functionality to annotate PDF documents.</p>
</div>
<div class="paragraph">
<p><em>PDFAnno</em> compared to <em>Hypothes.is</em> comes with a smaller code base and is less
complex.
Both editors feature span annotations, however only <em>PDFAnno</em> provides the
functionality to create relations between span annotations which is required
in <em>INCEpTION</em>.
As <em>Hypothes.is</em> was designed to share annotations with others a login mechanism
is part of the software.</p>
</div>
<div class="paragraph">
<p><em>PDFAnno</em> provides relations, is more lightweight and does not have a login
functionality, which would have to be removed.
Hence <em>PDFAnno</em> fits the requirements better than <em>Hypothes.is</em> and was
chosen as the PDF annotation tool for integration into <em>INCEpTION</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_differences_in_pdf_document_text_extractions"><a class="anchor" href="#_differences_in_pdf_document_text_extractions"></a>Differences in PDF Document Text Extractions</h3>
<div class="paragraph">
<p><em>PDFAnno</em> uses <a href="https://github.com/mozilla/pdf.js/">PDF.js</a> to render PDF documents
in the browser.
The tool <a href="https://github.com/inception-project/pdfextract"><em>PDFExtract</em></a> is used
to extract information about the PDF document text.
It produces a file in which each line contains information about one
character of the text.
Information includes the page, the character and the position coordinates of the
character in the PDF document, in the given order and separated by a tab character.
An example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1  E  0 1 2 3
1  x  4 5 6 7
1  a  8 9 10 11
1  m  12 13 14 15
1  p  16 17 18 19
1  l  20 21 22 23
1  e  24 25 26 27
2  [MOVE_TO]  28 29
2  NO_UNICODE  30 31 32 33</pre>
</div>
</div>
<div class="paragraph">
<p>There are also draw operations included which are of no relevance for the use in
<em>INCEpTION</em>.
Characters which have no unicode mapping have the value <code>NO_UNICODE</code>.
The <em>PDFExtract</em> file does not contain information about any whitespaces that
occur in the PDF document text.
<em>PDFAnno</em> requires the PDF document and the <em>PDFExtract</em> file to work.
The PDF document can be obtained from the <em>INCEpTION</em> backend.
To also provide the <em>PDFExtract</em> file, the tool was slightly modified so that it
can be used as a library in <em>INCEpTION</em>.</p>
</div>
<div class="paragraph">
<p><em>PDFAnno</em> provides an API for handling annotations.
It is possible to import a list of annotations by providing an URL for download.
This list has to be in the <em>TOML</em> format.
Span annotations require the begin and end positions of the characters it covers.
This positions are equal to the line number of characters in the <em>PDFExtract</em>
file.
A span annotation example in TOML format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[[span]]
id = "1"
page = 1
label = ""
color = "#ff00ff"
text = "Example"
textrange = [1, 7]</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>Brat</em> editor used in <em>INCEpTION</em> works only on plain text.
For PDF documents this plain text is obtained by the use of <em>DKPro PDF Reader</em>.
The reader extracts the text information from the PDF document and performs
operations to ensure correct text ordering and to replace certain character
sequences with substitutes from a substitution table.</p>
</div>
<div class="paragraph">
<p>As the extractions between <em>PDFAnno</em> and <em>INCEpTION</em> differ a mapping of
those representations must be implemented to ensure annotations can be exchanged
between the frontend and the backend and are usable across all editor modes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_representations"><a class="anchor" href="#_preparing_representations"></a>Preparing Representations</h3>
<div class="paragraph">
<p>To use a mapping method between the text representation of <em>PDFAnno</em> and
<em>INCEpTION</em> at first they must be preprocessed to have a similar structure.</p>
</div>
<div class="paragraph">
<p>As the <em>PDFExtract</em> file does not only contain the text string, first
the characters of the file need to be obtained and appended to a
string. All draw operations and <code>NO_UNICODE</code> lines are ignored.
As <em>DKPro PDF Reader</em> uses a substitution table to sanitize the document text,
the same substitution table is used to sanitize the obtained string.</p>
</div>
<div class="paragraph">
<p>The <em>PDFExtract</em> file does not contain any whitespaces present in the document
text, however <em>DKPro PDF Reader</em> preserves them.
The whitespaces are removed from the <em>DKPro PDF Reader</em> string to have a similar
structure to the <em>PDFExtract</em> sanitized string content.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./developer-guide/images/matching.png" alt="matching">
</div>
<div class="title">Figure 1. Mapping Process (left) with examples (right)</div>
</div>
<div class="paragraph">
<p>Even though both representations now are in a similar shape it can still happen
that the content in both strings differs.
For example ordering of text areas could be messed up which can especially happen
for PDF documents that contain multiple text columns on one page.
As both representations are not equal even after preprocessing, a mapping algorithm
has to be implemented to find the text of annotations from one representation in the
respective other representation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_annotations"><a class="anchor" href="#_mapping_annotations"></a>Mapping Annotations</h3>
<div class="paragraph">
<p>There are multiple ways to achieve a mapping between <em>PDFAnno</em> and <em>INCEpTION</em> for
annotations. Two methods were tested during development: exact string search
with context and sequence alignment.</p>
</div>
<div class="paragraph">
<p>The first option is to make an exact search for the annotation text.
However as annotations often cover only one token an exact
search for the annotation text would result in multiple occurrences.
To get a unique result it is required to add context to the annotation text.
As this still can yield multiple occurrences, context is expanded until a unique
mapping or no mapping at all is found.
Performing this for all annotations results in a lot of string search operations.
However the performance can be improved by searching for all annotations in the
target string at once with the help of the
<a href="https://en.wikipedia.org/wiki/Aho%E2%80%93Corasick_algorithm">Aho-Corasick</a> algorithm.</p>
</div>
<div class="paragraph">
<p>Another approach is to use sequence alignment methods which are popular in
bioinformatics.
PDF document texts are rather large and most sequence alignment algorithms
require O(M x N) memory space, where M and N are the size of the two sequences.
This results in a large memory consumption on computing the alignment, hence an
algorithm should be used that works with less memory.
Such an algorithm is <a href="https://en.wikipedia.org/wiki/Hirschberg%27s_algorithm">Hirschbergs algorithm</a>.
It consumes only O(min(M,N)) memory.</p>
</div>
<div class="paragraph">
<p>The advantage of the sequence alignment method would be a direct mapping between
the representation of <em>PDFExtract</em> and <em>DKPro PDF Reader</em>.
However, during testing for larger documents, for example 40 pages, the duration
until Hirschbergs algorithm finished was too long and would be unsatisfying for a user.
The exact string search however takes increasingly longer to compute mappings the
larger the document is and the more annotations have to be mapped.
As discussed the Aho-Corasick algorithm reduces the time. However, this still does not
scale well for larger documents.
To overcome this issue a page wise rendering of annotations was introduced.
When navigating through the PDF document in <em>PDFAnno</em> annotations are rendered
dynamically per page.
In detail, this means whenever the user moves through the document, the current
page changes and the user stops movement for 500 ms, the annotations for the
previous, current and next page are rendered.
This way large documents can be handled by the PDF editor without long wait times
for the user.</p>
</div>
<div class="paragraph">
<p>The exact string search seemed to perform well in terms of finding matching
occurrences for annotations in both directions.
For the manually tested documents all annotations were found and matched.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./developer-guide/images/inception-pdf-editor.png" alt="inception pdf editor">
</div>
<div class="title">Figure 2. PDF Editor Architecture</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_file_formats"><a class="anchor" href="#_file_formats"></a>File Formats</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to support different type of file formats for importing and exporting
annotated texts. The file format supports are mainly based on DKPro-Core-compatible reader and
writer UIMA components. They are then simply made known to the application via a <code>FormatSupport</code>
implementation.</p>
</div>
<div class="paragraph">
<p>The extension mechanism consists of the following classes and interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>FormatSupport</code> interface which provides the API necessary to make file formats known to the
application. It providse means to fetch the format ID and the human-readable format name shown
in the UI. It also allows to create reader and/or writer components. Various implementations of
this interface are included with the application, e.g. the <code>WebAnnoTsv3FormatSupport</code>.</p>
</li>
<li>
<p>The <code>ImportExportService</code> interface and its implementation <code>ImportExportServiceImpl</code> which provide
access to the registered format supports and also offers methods to import and export annotated
text in any of the formats.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repository"><a class="anchor" href="#_repository"></a>Repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The repository is a folder below the INCEpTION home folder which contains most of the
applications data that is not stored in the database. This includes in particular the original
documents imported into the application as well as annotations made by the users.</p>
</div>
<div class="paragraph">
<p>The source document data is managed by the <code>DocumentService</code> while the annotated documents are managed
by the <code>CasStorageService</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>┣ &lt;project ID&gt;.log</code> - project log file<br>
<code>┗ project</code><br>
<code>&#160;&#160;┗ &lt;project ID&gt;</code> - data related to the project with the given ID<br>
<code>&#160;&#160;&#160;&#160;┣ document</code> - managed by the <code>CasStorageService</code><br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;┗ &lt;document ID&gt;</code><br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;&#160;&#160;┗ annotation</code><br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;&#160;&#160;&#160;&#160;┣ INITIAL_CAS.ser</code> - initial converted version of the source document<br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;&#160;&#160;&#160;&#160;┣ &lt;user ID&gt;.ser</code><br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;&#160;&#160;&#160;&#160;┗ &lt;user ID&gt;.ser.&lt;timestamp&gt;.bak</code> - backups of the user&#8217;s annotations (if enabled)<br>
<code>&#160;&#160;&#160;&#160;┣ source</code> - managed by the <code>DocumentService</code><br>
<code>&#160;&#160;&#160;&#160;┃&#160;&#160;┗ &lt;original file&gt;</code> - original source file<br>
<code>&#160;&#160;&#160;&#160;┗ settings</code><br>
<code>&#160;&#160;&#160;&#160;&#160;&#160;┗ &lt;user ID&gt;</code> - user-specific preferences<br>
<code>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;┗ annotation.properties</code> - annotation preferences<br></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>include::./developer-guide/release.adoc</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<h1 id="_appendices" class="sect0"><a class="anchor" href="#_appendices"></a>Appendices</h1>
<div class="sect1">
<h2 id="sect_systemproperties"><a class="anchor" href="#sect_systemproperties"></a>Appendix A: System Properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket.core.settings.general.configuration-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Wicket debug mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">development</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 37.6<br>
Last updated 2025-09-02 09:22:38 +0200
</div>
</div>
</body>
</html>